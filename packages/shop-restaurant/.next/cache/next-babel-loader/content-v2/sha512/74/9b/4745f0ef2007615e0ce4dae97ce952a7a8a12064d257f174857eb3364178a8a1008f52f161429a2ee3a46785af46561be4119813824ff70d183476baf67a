{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/alejandrosandoval/space/world_eserp/web/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/alejandrosandoval/space/world_eserp/web/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/alejandrosandoval/space/world_eserp/web/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport Link from 'next/link';\nimport { Button } from 'components/button/button';\nimport { CURRENCY } from 'utils/constant';\nimport { Scrollbar } from 'components/scrollbar/scrollbar';\nimport CheckoutWrapper, { CheckoutContainer, CheckoutInformation, InformationBox, CheckoutSubmit, HaveCoupon, CouponBoxWrapper, CouponInputBox, CouponCode, RemoveCoupon, TermConditionText, TermConditionLink, CartWrapper, CalculationWrapper, OrderInfo, Title, ItemsWrapper, Items, Quantity, Multiplier, ItemInfo, Price, TextWrapper, Text, Bold, Small, NoProductMsg, NoProductImg } from './checkout-two.style';\nimport { NoCartBag } from 'assets/icons/NoCartBag';\nimport Sticky from 'react-stickynode';\nimport { ProfileContext } from 'contexts/profile/profile.context';\nimport { FormattedMessage } from 'react-intl';\nimport { useCart } from 'contexts/cart/use-cart';\nimport { useLocale } from 'contexts/language/language.provider';\nimport { useWindowSize } from 'utils/useWindowSize';\nimport Coupon from 'features/coupon/coupon';\nimport Address from 'features/address/address';\nimport Contact from 'features/contact/contact';\nimport { ADD_ORDER } from 'utils/graphql/mutation/order';\nimport { useMutation } from '@apollo/client';\nimport config from 'setting/config'; // The type of props Checkout Form receives\n\nvar OrderItem = function OrderItem(_ref) {\n  var product = _ref.product;\n  var id = product.id,\n      quantity = product.quantity,\n      title = product.title,\n      nombre = product.nombre,\n      unit = product.unit,\n      precio = product.precio,\n      precio_venta = product.precio_venta;\n  var displayPrice = precio_venta ? precio_venta : precio;\n  return /*#__PURE__*/_jsxs(Items, {\n    children: [/*#__PURE__*/_jsx(Quantity, {\n      children: quantity\n    }), /*#__PURE__*/_jsx(Multiplier, {\n      children: \"x\"\n    }), /*#__PURE__*/_jsxs(ItemInfo, {\n      children: [nombre ? nombre : title, \" \", unit ? \"| \".concat(unit) : '']\n    }), /*#__PURE__*/_jsxs(Price, {\n      children: [CURRENCY, (displayPrice * quantity).toFixed(0)]\n    })]\n  }, id);\n};\n\nvar CheckoutWithSidebar = function CheckoutWithSidebar(_ref2) {\n  var token = _ref2.token,\n      deviceType = _ref2.deviceType;\n\n  var _useState = useState(false),\n      hasCoupon = _useState[0],\n      setHasCoupon = _useState[1];\n\n  var _useContext = useContext(ProfileContext),\n      state = _useContext.state;\n\n  var _useLocale = useLocale(),\n      isRtl = _useLocale.isRtl;\n\n  var _useMutation = useMutation(ADD_ORDER),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      addOrder = _useMutation2[0],\n      error = _useMutation2[1].error;\n\n  var _useCart = useCart(),\n      items = _useCart.items,\n      removeCoupon = _useCart.removeCoupon,\n      coupon = _useCart.coupon,\n      clearCart = _useCart.clearCart,\n      cartItemsCount = _useCart.cartItemsCount,\n      calculatePrice = _useCart.calculatePrice,\n      calculateDiscount = _useCart.calculateDiscount,\n      calculateSubTotalPrice = _useCart.calculateSubTotalPrice,\n      isRestaurant = _useCart.isRestaurant,\n      toggleRestaurant = _useCart.toggleRestaurant;\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      isValid = _useState3[0],\n      setIsValid = _useState3[1];\n\n  var card = state.card,\n      schedules = state.schedules;\n\n  var _useState4 = useState([{\n    id: '1',\n    type: 'primary',\n    name: 'casa',\n    info: 'Miradores 20086 Pudahuel'\n  }]),\n      address = _useState4[0],\n      setAddress = _useState4[1];\n\n  var _useState5 = useState([{\n    id: '1',\n    type: 'primary',\n    name: 'personal',\n    number: '56963038688'\n  }]),\n      contact = _useState5[0],\n      setContact = _useState5[1];\n\n  var size = useWindowSize();\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var today, date, datedelivery;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              today = new Date(), date = today.getDate() + \"/\" + (today.getMonth() + 1) + \"/\" + today.getFullYear() + \"  \" + today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n              today.setMinutes(today.getMinutes() + 30);\n              datedelivery = today.getDate() + \"/\" + (today.getMonth() + 1) + \"/\" + today.getFullYear() + \"  \" + today.getHours() + \":\" + today.getMinutes() + \":\" + today.getSeconds();\n\n              if (!isValid) {\n                _context.next = 20;\n                break;\n              }\n\n              sessionStorage.setItem('items', JSON.stringify(items));\n              sessionStorage.setItem('address', address[0].info);\n              sessionStorage.setItem('contact', contact[0].number);\n              sessionStorage.setItem('order', Date.now().toString());\n              sessionStorage.setItem('itemscount', cartItemsCount);\n              sessionStorage.setItem('date', date.toString());\n              sessionStorage.setItem('datedelivery', datedelivery.toString());\n              sessionStorage.setItem('total', calculatePrice());\n              sessionStorage.setItem('discount', calculateDiscount());\n              sessionStorage.setItem('subtotal', calculateSubTotalPrice());\n              _context.next = 17;\n              return add_order();\n\n            case 17:\n              // backend\n              console.log('viajando a la orden recibida');\n              clearCart();\n              Router.push('/order-received');\n\n            case 20:\n              setLoading(false);\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var add_order = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log('ingreando add_order!!!!');\n              console.log('clientid:', config().SUBSCRIPTION_ID);\n              console.log('cliente:', 1);\n              console.log('total:', calculatePrice());\n              console.log('subtotal:', calculateSubTotalPrice());\n              console.log('order:', sessionStorage.getItem('order'));\n              console.log('items:', '');\n              console.log('itemcount:', cartItemsCount);\n              console.log('discount:', calculateDiscount());\n              console.log('delivery_date:', sessionStorage.getItem('datedelivery'));\n              console.log('order_date:', sessionStorage.getItem('date'));\n              console.log('delivery_address:', address[0].info);\n              console.log('contacto:', contact[0].number);\n              console.log('status:', 'Procesando');\n              console.log('estado:', 'Normal');\n              console.log('ingreando add_order 2');\n              _context2.next = 18;\n              return addOrder({\n                variables: {\n                  clientid: config().SUBSCRIPTION_ID,\n                  cliente: 1,\n                  total: calculatePrice(),\n                  subtotal: calculateSubTotalPrice(),\n                  metodo_pago: 'card',\n                  order: sessionStorage.getItem('order').toString(),\n                  items: JSON.stringify(items),\n                  itemcount: cartItemsCount,\n                  discount: calculateDiscount(),\n                  delivery_date: sessionStorage.getItem('datedelivery'),\n                  order_date: sessionStorage.getItem('date'),\n                  delivery_address: address[0].info,\n                  contacto: contact[0].number,\n                  status: 'Procesando',\n                  received: true,\n                  estado: 'Normal'\n                }\n              });\n\n            case 18:\n              console.log('ingreando add_order termino satisfactoriamente');\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function add_order() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    console.log('singularidad', calculatePrice(), cartItemsCount, address.length, contact.length);\n\n    if (calculatePrice() > 0 && cartItemsCount > 0\n    /*       address.length &&\n          contact.length  */\n\n    /*       schedules.length */\n    ) {\n        setIsValid(true);\n      }\n  }, [state]);\n  useEffect(function () {\n    return function () {\n      if (isRestaurant) {\n        toggleRestaurant();\n        clearCart();\n      }\n    };\n  }, []);\n  return /*#__PURE__*/_jsxs(\"form\", {\n    children: [/*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(CheckoutWrapper, {\n      children: /*#__PURE__*/_jsxs(CheckoutContainer, {\n        children: [/*#__PURE__*/_jsxs(CheckoutInformation, {\n          children: [/*#__PURE__*/_jsx(InformationBox, {\n            children: /*#__PURE__*/_jsx(Address, {\n              increment: true,\n              flexStart: true,\n              buttonProps: {\n                variant: 'text',\n                type: 'button',\n                className: 'addButton'\n              },\n              icon: true\n            })\n          }), /*#__PURE__*/_jsx(InformationBox, {\n            children: /*#__PURE__*/_jsx(Contact, {\n              increment: true,\n              flexStart: true,\n              buttonProps: {\n                variant: 'text',\n                type: 'button',\n                className: 'addButton'\n              },\n              icon: true\n            })\n          }), /*#__PURE__*/_jsxs(InformationBox, {\n            className: \"paymentBox\",\n            style: {\n              paddingBottom: 30\n            },\n            children: [coupon ? /*#__PURE__*/_jsx(CouponBoxWrapper, {\n              children: /*#__PURE__*/_jsxs(CouponCode, {\n                children: [/*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"couponApplied\"\n                }), /*#__PURE__*/_jsx(\"span\", {\n                  children: coupon.code\n                }), /*#__PURE__*/_jsx(RemoveCoupon, {\n                  onClick: function onClick(e) {\n                    e.preventDefault();\n                    removeCoupon();\n                    setHasCoupon(false);\n                  },\n                  children: /*#__PURE__*/_jsx(FormattedMessage, {\n                    id: \"removeCoupon\"\n                  })\n                })]\n              })\n            }) : /*#__PURE__*/_jsx(CouponBoxWrapper, {\n              children: !hasCoupon ? /*#__PURE__*/_jsx(HaveCoupon, {\n                onClick: function onClick() {\n                  return setHasCoupon(function (prev) {\n                    return !prev;\n                  });\n                },\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"specialCode\",\n                  defaultMessage: \"Tienes un c\\xF3digo especial?\"\n                })\n              }) : /*#__PURE__*/_jsx(CouponInputBox, {\n                children: /*#__PURE__*/_jsx(Coupon, {\n                  errorMsgFixed: true,\n                  className: \"normalCoupon\"\n                })\n              })\n            }), /*#__PURE__*/_jsxs(TermConditionText, {\n              children: [/*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"termAndConditionHelper\",\n                defaultMessage: \"By making this purchase you agree to our\"\n              }), /*#__PURE__*/_jsx(Link, {\n                href: \"#\",\n                children: /*#__PURE__*/_jsx(TermConditionLink, {\n                  children: /*#__PURE__*/_jsx(FormattedMessage, {\n                    id: \"termAndCondition\",\n                    defaultMessage: \"T\\xE9rminos y Condiciones.\"\n                  })\n                })\n              })]\n            }), /*#__PURE__*/_jsx(CheckoutSubmit, {\n              children: /*#__PURE__*/_jsx(Button, {\n                type: \"button\",\n                onClick: handleSubmit,\n                disabled: !isValid,\n                size: \"big\",\n                loading: loading,\n                style: {\n                  width: '100%'\n                },\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"processCheckout\",\n                  defaultMessage: \"Procesar Checkout\"\n                })\n              })\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(CartWrapper, {\n          children: /*#__PURE__*/_jsx(Sticky, {\n            enabled: size.width >= 768 ? true : false,\n            top: 120,\n            innerZ: 999,\n            children: /*#__PURE__*/_jsxs(OrderInfo, {\n              children: [/*#__PURE__*/_jsx(Title, {\n                children: /*#__PURE__*/_jsx(FormattedMessage, {\n                  id: \"cartTitle\",\n                  defaultMessage: \"Su Pedido\"\n                })\n              }), /*#__PURE__*/_jsx(Scrollbar, {\n                className: \"checkout-scrollbar\",\n                children: /*#__PURE__*/_jsx(ItemsWrapper, {\n                  children: cartItemsCount > 0 ? items.map(function (item) {\n                    return /*#__PURE__*/_jsx(OrderItem, {\n                      product: item\n                    }, \"cartItem-\".concat(item.id));\n                  }) : /*#__PURE__*/_jsxs(_Fragment, {\n                    children: [/*#__PURE__*/_jsx(NoProductImg, {\n                      children: /*#__PURE__*/_jsx(NoCartBag, {})\n                    }), /*#__PURE__*/_jsx(NoProductMsg, {\n                      children: /*#__PURE__*/_jsx(FormattedMessage, {\n                        id: \"noProductFound\",\n                        defaultMessage: \"No hay productos encontrados\"\n                      })\n                    })]\n                  })\n                })\n              }), /*#__PURE__*/_jsxs(CalculationWrapper, {\n                children: [/*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"subTotal\",\n                      defaultMessage: \"Sub Total\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [CURRENCY, calculateSubTotalPrice()]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"intlOrderDetailsDelivery\",\n                      defaultMessage: \"Delivery Fee\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [CURRENCY, \"0\"]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  children: [/*#__PURE__*/_jsx(Text, {\n                    children: /*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"discountText\",\n                      defaultMessage: \"Descuento\"\n                    })\n                  }), /*#__PURE__*/_jsxs(Text, {\n                    children: [CURRENCY, calculateDiscount()]\n                  })]\n                }), /*#__PURE__*/_jsxs(TextWrapper, {\n                  style: {\n                    marginTop: 20\n                  },\n                  children: [/*#__PURE__*/_jsxs(Bold, {\n                    children: [/*#__PURE__*/_jsx(FormattedMessage, {\n                      id: \"totalText\",\n                      defaultMessage: \"Total\"\n                    }), ' ', /*#__PURE__*/_jsxs(Small, {\n                      children: [\"(\", /*#__PURE__*/_jsx(FormattedMessage, {\n                        id: \"vatText\",\n                        defaultMessage: \"Incl. VAT\"\n                      }), \")\"]\n                    })]\n                  }), /*#__PURE__*/_jsxs(Bold, {\n                    children: [CURRENCY, calculatePrice()]\n                  })]\n                })]\n              })]\n            })\n          })\n        })]\n      })\n    })]\n  });\n};\n\nexport default CheckoutWithSidebar;","map":null,"metadata":{},"sourceType":"module"}