{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/sebastian/space/web/packages/shop-restaurant/src/layouts/header/menu/authorized-menu.tsx\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport NavLink from 'components/nav-link/nav-link';\nimport { AUTHORIZED_MENU_ITEMS } from 'site-settings/site-navigation';\nimport { useCart } from 'contexts/cart/use-cart';\nimport Cookies from 'universal-cookie';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport Router from 'next/router';\nimport localForage from 'localforage';\nimport { useMutation, useQuery } from '@apollo/client';\nimport { GET_ABANDONADOS } from 'utils/graphql/query/abandonados.query';\nimport { AGREGAR_ABANDONADO } from 'utils/graphql/mutation/abandonados';\nimport { UPGRADE_ABANDONADO } from 'utils/graphql/mutation/abandonados';\nexport const AuthorizedMenu = ({\n  onLogout\n}) => {\n  const cookie = new Cookies();\n  const cid = cookie.get('clientid');\n  const {\n    authDispatch\n  } = useContext(AuthContext);\n  var {\n    0: carrito,\n    1: setCarrito\n  } = useState('');\n  const [insert_abandonado] = useMutation(AGREGAR_ABANDONADO);\n  const [upgrade_abandonado] = useMutation(UPGRADE_ABANDONADO);\n  const {\n    data\n  } = useQuery(GET_ABANDONADOS, {\n    variables: {\n      clientid: cid,\n      customerid: cookie.get('customer') && cookie.get('customer').id\n    }\n  });\n  const {\n    clearCart\n  } = useCart();\n\n  const init = async () => {\n    if (localForage) {\n      var keys = await localForage.keys();\n      console.log('key', keys);\n      return Promise.all(keys.map(async key => {\n        if (key === '@session') {\n          console.log('|||||', await localForage.getItem(key));\n          setCarrito(await localForage.getItem(key));\n        }\n      }));\n    }\n  };\n\n  useEffect(() => {\n    init();\n  });\n\n  function deleteAllCookies() {\n    var cookies = document.cookie.split(\";\");\n\n    for (var i = 0; i < cookies.length; i++) {\n      var cookie = cookies[i];\n      var eqPos = cookie.indexOf(\"=\");\n      var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n      document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n    }\n  }\n\n  const push = async () => {\n    console.log('push!', carrito);\n\n    if (carrito !== '' && carrito !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}') {\n      await insert_abandonado({\n        variables: {\n          clientid: cid,\n          customerid: cookie.get('customer') && cookie.get('customer').id,\n          data_json: carrito\n        }\n      });\n    }\n  };\n\n  const put = async () => {\n    if (carrito !== '' && carrito !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}') {\n      await upgrade_abandonado({\n        variables: {\n          \"clientid\": cid,\n          \"customerid\": cookie.get('customer') && cookie.get('customer').id,\n          \"data_json\": carrito\n        }\n      });\n    }\n  };\n\n  const handleLogout = async () => {\n    if (data && data.carritos_abandonados && data.carritos_abandonados.length > 0) {\n      await put();\n    }\n\n    if (data && data.carritos_abandonados && data.carritos_abandonados.length === 0) {\n      await push();\n    }\n\n    await cookie.remove('access_token');\n    await cookie.remove('customer');\n    await cookie.remove('user_logged');\n    localForage.removeItem('@session');\n    await deleteAllCookies();\n    await clearCart();\n    authDispatch({\n      type: 'SIGN_OUT'\n    });\n    Router.push('/grocery');\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [AUTHORIZED_MENU_ITEMS.map((item, idx) => /*#__PURE__*/_jsxDEV(NavLink, {\n      className: \"menu-item\",\n      href: item.href,\n      label: item.defaultMessage,\n      intlId: item.id\n    }, idx, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 9\n    }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"menu-item\",\n      onClick: handleLogout,\n      children: /*#__PURE__*/_jsxDEV(\"a\", {\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"nav.logout\",\n            defaultMessage: \"Logout\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 140,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};","map":{"version":3,"sources":["/Users/sebastian/space/web/packages/shop-restaurant/src/layouts/header/menu/authorized-menu.tsx"],"names":["React","useContext","useEffect","useState","FormattedMessage","NavLink","AUTHORIZED_MENU_ITEMS","useCart","Cookies","AuthContext","Router","localForage","useMutation","useQuery","GET_ABANDONADOS","AGREGAR_ABANDONADO","UPGRADE_ABANDONADO","AuthorizedMenu","onLogout","cookie","cid","get","authDispatch","carrito","setCarrito","insert_abandonado","upgrade_abandonado","data","variables","clientid","customerid","id","clearCart","init","keys","console","log","Promise","all","map","key","getItem","deleteAllCookies","cookies","document","split","i","length","eqPos","indexOf","name","substr","push","data_json","put","handleLogout","carritos_abandonados","remove","removeItem","type","item","idx","href","defaultMessage"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport NavLink from 'components/nav-link/nav-link';\nimport { AUTHORIZED_MENU_ITEMS } from 'site-settings/site-navigation';\nimport { useCart } from 'contexts/cart/use-cart';\nimport Cookies  from 'universal-cookie';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport Router from 'next/router';\nimport localForage from 'localforage'; \nimport { useMutation, useQuery } from '@apollo/client';\nimport { GET_ABANDONADOS } from 'utils/graphql/query/abandonados.query';\nimport { AGREGAR_ABANDONADO } from 'utils/graphql/mutation/abandonados';\nimport { UPGRADE_ABANDONADO } from 'utils/graphql/mutation/abandonados';\n\ntype Props = {\n  onLogout: () => void;\n};\n\n\nexport const AuthorizedMenu: React.FC<Props> = ({ onLogout }) => {\n\n  const cookie = new Cookies()\n  const cid = cookie.get('clientid')\n  const { authDispatch } = useContext<any>(AuthContext);\n  var [carrito, setCarrito] = useState('');\n\n  const [insert_abandonado] = useMutation(AGREGAR_ABANDONADO); \n  const [upgrade_abandonado] = useMutation(UPGRADE_ABANDONADO); \n\n  const { data } = useQuery(\n    GET_ABANDONADOS,\n    {\n      variables: { \n        clientid: cid,\n        customerid: cookie.get('customer') &&  cookie.get('customer').id\n      }\n    }\n  );\n\n  const { \n    clearCart,\n  } = useCart();\n\n  const init = async ()=> {\n    if (localForage) {\n      var keys = await localForage.keys()\n      console.log('key',keys)\n      return Promise.all(keys.map(async key => {\n        if(key==='@session'){\n          console.log('|||||', await localForage.getItem(key))\n          setCarrito(await localForage.getItem(key))\n        }  \n      }))\n     }\n  }\n\n\n  useEffect(() => {\n     init()\n  })\n\n\n  function deleteAllCookies() {\n  \n    var cookies = document.cookie.split(\";\");\n  \n    for (var i = 0; i < cookies.length; i++) {\n        var cookie = cookies[i];\n        var eqPos = cookie.indexOf(\"=\");\n        var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;\n        document.cookie = name + \"=;expires=Thu, 01 Jan 1970 00:00:00 GMT\";\n    }\n  }\n \n  const push = async () => {\n\n    console.log('push!', carrito)  \n    if(carrito !== '' && carrito !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}')\n    {\n      await insert_abandonado({\n        variables: { \n          clientid: cid,\n          customerid: cookie.get('customer') && cookie.get('customer').id,\n          data_json: carrito\n        },\n      });  \n    }  \n  \n}\n\n  const put = async () => {\n    if(carrito !== '' && carrito !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}')\n    {\n      await upgrade_abandonado({\n        variables: { \n          \"clientid\": cid,\n          \"customerid\": cookie.get('customer') && cookie.get('customer').id,\n          \"data_json\": carrito\n        },\n      });  \n   } \n  }\n\n   \n\n  const handleLogout = async () => { \n  \n\n     if ( data && data.carritos_abandonados && data.carritos_abandonados.length > 0 ) {\n        await put()\n     } \n     if ( data && data.carritos_abandonados && data.carritos_abandonados.length === 0 ) {\n        await push()\n     }  \n     \n      await cookie.remove('access_token');\n      await cookie.remove('customer'); \n      await cookie.remove('user_logged'); \n      localForage.removeItem('@session');\n      await deleteAllCookies(); \n      await clearCart(); \n      authDispatch({ type: 'SIGN_OUT' });\n      Router.push('/grocery');\n  };\n\n  return (\n    <>\n      {AUTHORIZED_MENU_ITEMS.map((item, idx) => (\n        <NavLink\n          key={idx}\n          className='menu-item'\n          href={item.href}\n          label={item.defaultMessage}\n          intlId={item.id}\n        />\n      ))}\n      <div className='menu-item' onClick={handleLogout}>\n        <a>\n          <span>\n            <FormattedMessage id='nav.logout' defaultMessage='Logout' />\n          </span>\n        </a>\n      </div>\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}