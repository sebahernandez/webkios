{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/alejandrosandoval/space/world_eserp/web/packages/shop-restaurant/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/alejandrosandoval/space/world_eserp/web/packages/shop-restaurant/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useContext, useState, useEffect } from 'react';\nimport Router from 'next/router';\nimport { Button } from 'components/button/button';\nimport CheckoutWrapper, { CheckoutContainer, OrderSummary, OrderSummaryItem, OrderLabel, OrderAmount, DeliverySchedule, DeliveryAddress, StyledContact, PaymentOption, CheckoutSubmit, CouponBoxWrapper } from './checkout-one.style';\nimport { CouponDisplay } from 'components/coupon-box/coupon-box';\nimport { ProfileContext } from 'contexts/profile/profile.context';\nimport { FormattedMessage } from 'react-intl';\nimport { useCart } from 'contexts/cart/use-cart';\nimport Schedules from 'features/schedule/schedule';\nimport Address from 'features/address/address';\nimport Coupon from 'features/coupon/coupon';\nimport Contact from 'features/contact/contact';\nimport Payment from 'features/payment/payment'; // The type of props Checkout Form receives\n\nvar Checkout = function Checkout(_ref) {\n  var token = _ref.token,\n      deviceType = _ref.deviceType;\n\n  var _useCart = useCart(),\n      removeCoupon = _useCart.removeCoupon,\n      coupon = _useCart.coupon,\n      clearCart = _useCart.clearCart,\n      cartItemsCount = _useCart.cartItemsCount,\n      calculatePrice = _useCart.calculatePrice,\n      calculateDiscount = _useCart.calculateDiscount,\n      calculateSubTotalPrice = _useCart.calculateSubTotalPrice,\n      isRestaurant = _useCart.isRestaurant,\n      toggleRestaurant = _useCart.toggleRestaurant;\n\n  var _useContext = useContext(ProfileContext),\n      state = _useContext.state;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      isValid = _useState2[0],\n      setIsValid = _useState2[1];\n\n  var address = state.address,\n      contact = state.contact,\n      card = state.card,\n      schedules = state.schedules;\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n\n              if (isValid) {\n                clearCart();\n                Router.push('/order-received');\n              }\n\n              setLoading(false);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (calculatePrice() > 0 && cartItemsCount > 0 && address.length && contact.length && card.length && schedules.length) {\n      setIsValid(true);\n    }\n  }, [state]);\n  useEffect(function () {\n    return function () {\n      if (isRestaurant) {\n        toggleRestaurant();\n        clearCart();\n      }\n    };\n  }, []);\n  return /*#__PURE__*/_jsx(\"form\", {\n    children: /*#__PURE__*/_jsx(CheckoutWrapper, {\n      children: /*#__PURE__*/_jsxs(CheckoutContainer, {\n        children: [/*#__PURE__*/_jsxs(OrderSummary, {\n          children: [/*#__PURE__*/_jsxs(OrderSummaryItem, {\n            style: {\n              marginBottom: 15\n            },\n            children: [/*#__PURE__*/_jsxs(OrderLabel, {\n              children: [/*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"subTotal\",\n                defaultMessage: \"Subtotal\"\n              }), \" (\", cartItemsCount, ' ', /*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"itemsText\",\n                defaultMessage: \"items\"\n              }), \")\"]\n            }), /*#__PURE__*/_jsxs(OrderAmount, {\n              children: [\"$\", calculateSubTotalPrice()]\n            })]\n          }), /*#__PURE__*/_jsxs(OrderSummaryItem, {\n            style: {\n              marginBottom: 30\n            },\n            children: [/*#__PURE__*/_jsx(OrderLabel, {\n              children: /*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"shippingFeeText\",\n                defaultMessage: \"Shipping Fee\"\n              })\n            }), /*#__PURE__*/_jsx(OrderAmount, {\n              children: \"$0\"\n            })]\n          }), /*#__PURE__*/_jsxs(OrderSummaryItem, {\n            style: {\n              marginBottom: 30\n            },\n            className: \"voucherWrapper\",\n            children: [/*#__PURE__*/_jsx(OrderLabel, {\n              children: /*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"voucherText\",\n                defaultMessage: \"Voucher\"\n              })\n            }), coupon ? /*#__PURE__*/_jsx(CouponDisplay, {\n              code: coupon.code,\n              sign: \"-\",\n              currency: \"$\",\n              price: calculateDiscount(),\n              onClick: function onClick(e) {\n                e.preventDefault();\n                removeCoupon();\n              }\n            }) : /*#__PURE__*/_jsx(CouponBoxWrapper, {\n              children: /*#__PURE__*/_jsx(Coupon, {\n                errorMsgFixed: true,\n                style: {\n                  maxWidth: 350,\n                  height: 50\n                }\n              })\n            })]\n          }), /*#__PURE__*/_jsxs(OrderSummaryItem, {\n            children: [/*#__PURE__*/_jsx(OrderLabel, {\n              children: /*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"totalText\",\n                defaultMessage: \"Total\"\n              })\n            }), /*#__PURE__*/_jsxs(OrderAmount, {\n              children: [\"$\", calculatePrice()]\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(DeliverySchedule, {\n          children: /*#__PURE__*/_jsx(Schedules, {})\n        }), /*#__PURE__*/_jsx(DeliveryAddress, {\n          children: /*#__PURE__*/_jsx(Address, {})\n        }), /*#__PURE__*/_jsx(StyledContact, {\n          children: /*#__PURE__*/_jsx(Contact, {})\n        }), /*#__PURE__*/_jsx(PaymentOption, {\n          children: /*#__PURE__*/_jsx(Payment, {\n            deviceType: deviceType\n          })\n        }), /*#__PURE__*/_jsx(CheckoutSubmit, {\n          children: /*#__PURE__*/_jsx(Button, {\n            type: \"button\",\n            onClick: handleSubmit,\n            disabled: !isValid,\n            size: \"big\",\n            loading: loading,\n            width: \"100%\",\n            children: /*#__PURE__*/_jsx(FormattedMessage, {\n              id: \"processCheckout\",\n              defaultMessage: \"Proceed to Checkout\"\n            })\n          })\n        })]\n      })\n    })\n  });\n};\n\nexport default Checkout;","map":null,"metadata":{},"sourceType":"module"}