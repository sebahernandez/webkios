{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useState, useEffect } from 'react';\nimport { Scrollbar } from 'components/scrollbar/scrollbar';\nimport { gql, useSubscription } from '@apollo/client';\nimport { DesktopView, MobileView, OrderBox, OrderListWrapper, OrderList, OrderDetailsWrapper, Title, ImageWrapper, ItemWrapper, ItemDetails, ItemName, ItemSize, ItemPrice, NoOrderFound } from './order.style';\nimport OrderDetails from './order-details/order-details';\nimport OrderCard from './order-card/order-card';\nimport OrderCardMobile from './order-card/order-card-mobile';\nimport useComponentSize from 'utils/useComponentSize';\nimport { FormattedMessage } from 'react-intl';\nimport config from 'setting/config';\nconst cid = config().SUBSCRIPTION_ID;\nconst GET_ORDERS = gql`\n  query getAllOrders($text: String, $user: Int!, $limit: Int) {\n    orders(text: $text, limit: $limit, user: $user) {\n      id\n      status\n      deliveryAddress\n      amount\n      date\n      subtotal\n      deliveryFee\n      discount\n      deliveryTime\n      products {\n        title\n        price\n        total\n        image\n        weight\n        quantity\n        id\n      }\n    }\n  }\n`;\nconst GET_ORDERS_PUBLIC = gql`\nsubscription fetchPublicOrders($clientid: String!, $limit: Int!, $user: Int!) {\n  pedido(limit: $limit, where: {cliente: {_eq: $user},clientid: {_eq: $clientid}, _and: {is_received: {_eq: true}}}, order_by: {creation_date: desc}) {\n    id\n    cliente\n    order\n    total\n    delivery_address\n    delivery_date\n    total\n    subtotal\n    discount\n    order_date\n    is_received\n    is_process\n    is_delivery\n    is_closed\n    is_cancelled\n    items  \n    itemcount\n  }\n}\n`;\nconst progressData = ['Órden Recibida', 'En Preparación', 'Órden en Camino', 'Órden Entregada'];\nconst orderTableColumns = [{\n  title: /*#__PURE__*/_jsx(FormattedMessage, {\n    id: \"cartItems\",\n    defaultMessage: \"Items\"\n  }),\n  dataIndex: '',\n  key: 'items',\n  width: 250,\n  ellipsis: true,\n  render: (text, record) => {\n    return /*#__PURE__*/_jsxs(ItemWrapper, {\n      children: [/*#__PURE__*/_jsx(ImageWrapper, {\n        children: /*#__PURE__*/_jsx(\"img\", {\n          src: record.imageURL,\n          alt: record.descripcion\n        })\n      }), /*#__PURE__*/_jsxs(ItemDetails, {\n        children: [/*#__PURE__*/_jsx(ItemName, {\n          children: record.nombre\n        }), /*#__PURE__*/_jsx(ItemSize, {\n          children: record.cantidad\n        }), /*#__PURE__*/_jsxs(ItemPrice, {\n          children: [\"$\", record.precio_venta]\n        })]\n      })]\n    });\n  }\n}, {\n  title: /*#__PURE__*/_jsx(FormattedMessage, {\n    id: \"intlTableColTitle2\",\n    defaultMessage: \"Quantity\"\n  }),\n  dataIndex: 'quantity',\n  key: 'quantity',\n  align: 'center',\n  width: 100\n}, {\n  title: /*#__PURE__*/_jsx(FormattedMessage, {\n    id: \"intlTableColTitle3\",\n    defaultMessage: \"Price\"\n  }),\n  dataIndex: '',\n  key: 'price',\n  align: 'right',\n  width: 100,\n  render: (text, record) => {\n    return /*#__PURE__*/_jsxs(\"p\", {\n      children: [\"$\", record.total]\n    });\n  }\n}];\nconst data1 = {\n  orders: [{\n    id: '1',\n    status: '2',\n    deliveryAddress: 'delivery',\n    amount: 'delivery',\n    date: 'delivery',\n    subtotal: 'delivery',\n    deliveryFee: 'delivery',\n    discount: 'delivery',\n    deliveryTime: 'delivery',\n    products: [{\n      title: 'titulo1',\n      price: 1010,\n      total: 2020,\n      image: 'img1',\n      weight: 2000,\n      quantity: 10,\n      id: '10'\n    }]\n  }]\n};\n\nconst OrdersContent = () => {\n  const {\n    0: order,\n    1: setOrder\n  } = useState(null);\n  const {\n    0: active,\n    1: setActive\n  } = useState('');\n  const [targetRef, size] = useComponentSize();\n  const orderListHeight = size.height - 79; // Carga de Pedidos del Usuario Logueado\n\n  const {\n    data,\n    error,\n    loading\n  } = useSubscription(GET_ORDERS_PUBLIC, {\n    variables: {\n      limit: 5,\n      user: 1,\n      clientid: cid\n    }\n  });\n  useEffect(() => {\n    if (data && data.pedido && data.pedido.length !== 0) {\n      setOrder(data.pedido[0]);\n      setActive(data.pedido[0].id);\n    }\n  }, [data && data.pedido]);\n\n  if (loading) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      children: \"loading...\"\n    });\n  }\n\n  if (error) return /*#__PURE__*/_jsx(\"div\", {\n    children: error.message\n  });\n\n  const handleClick = order => {\n    setOrder(order);\n    setActive(order.id);\n  };\n\n  const currentStatus = order => {\n    if (order.is_closed) {\n      return 3;\n    } else {\n      if (order.is_delivery) {\n        return 2;\n      } else {\n        if (order.is_process) {\n          return 1;\n        } else {\n          return 0;\n        }\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(OrderBox, {\n    children: [/*#__PURE__*/_jsxs(DesktopView, {\n      children: [/*#__PURE__*/_jsxs(OrderListWrapper, {\n        style: {\n          height: size.height\n        },\n        children: [/*#__PURE__*/_jsx(Title, {\n          style: {\n            padding: '0 20px'\n          },\n          children: /*#__PURE__*/_jsx(FormattedMessage, {\n            id: \"intlOrderPageTitle\",\n            defaultMessage: \"Mi Pedido\"\n          })\n        }), /*#__PURE__*/_jsx(Scrollbar, {\n          className: \"order-scrollbar\",\n          children: /*#__PURE__*/_jsx(OrderList, {\n            children: data.pedido.length !== 0 ? data.pedido.map(current => /*#__PURE__*/_jsx(OrderCard, {\n              orderId: current.order,\n              className: current.id === active ? 'active' : '',\n              status: progressData[currentStatus(current)],\n              date: current.order_date,\n              deliveryTime: current.delivery_date,\n              amount: current.total,\n              onClick: () => {\n                handleClick(current);\n              }\n            }, current.id)) : /*#__PURE__*/_jsx(NoOrderFound, {\n              children: /*#__PURE__*/_jsx(FormattedMessage, {\n                id: \"intlNoOrderFound\",\n                defaultMessage: \"\\xD3rden no Encontrada\"\n              })\n            })\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(OrderDetailsWrapper, {\n        ref: targetRef,\n        children: [/*#__PURE__*/_jsx(Title, {\n          style: {\n            padding: '0 20px'\n          },\n          children: /*#__PURE__*/_jsx(FormattedMessage, {\n            id: \"orderDetailsText\",\n            defaultMessage: \"Detalle de la \\xD3rden\"\n          })\n        }), order && order.id && /*#__PURE__*/_jsx(OrderDetails, {\n          progressStatus: currentStatus(order) + 1,\n          progressData: progressData,\n          address: order.delivery_address,\n          subtotal: order.subtotal,\n          discount: order.discount,\n          deliveryFee: order.deliveryFee,\n          grandTotal: order.total,\n          tableData: order.items.length > 0 ? JSON.parse(order.items) : order.products,\n          columns: orderTableColumns\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(MobileView, {\n      children: /*#__PURE__*/_jsx(OrderList, {\n        children: /*#__PURE__*/_jsx(OrderCardMobile, {\n          pedido: data.pedido,\n          className: order && order.id === active ? 'active' : '',\n          progressData: progressData,\n          columns: orderTableColumns,\n          onClick: () => {\n            handleClick(order);\n          }\n        })\n      })\n    })]\n  });\n};\n\nexport default OrdersContent;","map":null,"metadata":{},"sourceType":"module"}