{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/sebastian/space/web/packages/shop-restaurant/src/features/authentication-form/login.tsx\";\nimport React, { useEffect, useContext, useState } from 'react';\nimport { LinkButton, Button, Wrapper, Container, Heading, SubHeading, OfferSection, Offer } from './authentication-form.style';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport { FormattedMessage } from 'react-intl';\nimport { closeModal } from '@redq/reuse-modal';\nimport { useQuery, useMutation } from '@apollo/client';\nimport { GET_CLIENTE_USERNAME } from '../../utils/graphql/query/clients.query';\nimport { GET_ABANDONADOS } from '../../utils/graphql/query/abandonados.query';\nimport { ADD_CLIENTE } from '../../utils/graphql/mutation/register_client';\nimport { ADD_VISITA } from '../../utils/graphql/mutation/visitas';\nimport GoogleLogin from 'react-google-login';\nimport Cookies from 'universal-cookie';\nimport { useRouter } from 'next/router';\nimport localforage from 'localforage';\nexport default function SignInModal({\n  cid\n}) {\n  const {\n    authDispatch\n  } = useContext(AuthContext);\n  const [id, setId] = React.useState(0);\n  const [user, setUser] = React.useState(null);\n  const [closed, setClosed] = React.useState(false);\n  const [email, setEmail] = React.useState('');\n  const [customerid, setCustomerid] = React.useState(0);\n  const [addVisita] = useMutation(ADD_VISITA);\n  const [addCliente, {\n    data: data2,\n    loading,\n    error: error2\n  }] = useMutation(ADD_CLIENTE);\n  const cookie = new Cookies();\n  const router = useRouter();\n  const {\n    0: carrito,\n    1: setCarrito\n  } = useState('');\n  useEffect(() => {\n    console.log('cookie', cookie.get('user_logged'));\n    console.log('localforage', localforage.getItem('@session'));\n  }, [cookie, localforage]); // Ingresando function de carga de Carrito Abandonado  \n\n  function LoadCarritoAbandonado({\n    customerid\n  }) {\n    console.log('....... 1');\n    console.log('....... 1.1 ', 'customerid:', customerid);\n    let {\n      data\n    } = useQuery(GET_ABANDONADOS, {\n      variables: {\n        clientid: cid,\n        customerid: customerid\n      }\n    });\n    console.log('....... 2');\n\n    if (data && data.carritos_abandonados && data.carritos_abandonados.length > 0) {\n      localforage.setItem('@session', data.carritos_abandonados[0].data_json);\n    }\n\n    console.log('checkout...');\n    if (data && data.carritos_abandonados.length > 0 && data.carritos_abandonados[0].data_json !== '' && data.carritos_abandonados[0].data_json !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}') router.push('/');\n    return null;\n  }\n\n  function LoadUser({\n    email\n  }) {\n    let {\n      loading,\n      error,\n      data\n    } = useQuery(GET_CLIENTE_USERNAME, {\n      variables: {\n        clientid: cid,\n        username: email\n      }\n    });\n\n    if (error) {\n      console.log(error);\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"Error \", error]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 16\n      }, this);\n    }\n\n    if (loading) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading ...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 16\n      }, this);\n    }\n\n    console.log('data:', data);\n\n    if (data && data.cliente && data.cliente.length > 0) {\n      setCustomerid(data.cliente[0].id);\n      console.log(',,,,', customerid);\n      addVisita({\n        variables: {\n          cliente: customerid,\n          clientid: cid\n        }\n      });\n      cookie.set('customer', data.cliente[0]);\n      closeModal();\n    } else {\n      console.log('loadUser else');\n      console.log('loadUser email ', email);\n\n      if (id === 0) {\n        try {\n          addCliente({\n            variables: {\n              username: email,\n              clientid: cid\n            }\n          });\n        } catch (error) {\n          console.log(error);\n        }\n      }\n\n      if (data2 && id === 0) {\n        cookie.set('customer', data2.insert_cliente.returning[0].id);\n        setId(data2.insert_cliente.returning[0].id);\n\n        if (cookie.get('login') === '2') {\n          router.push('/checkout');\n        }\n\n        closeModal();\n      }\n    }\n\n    return null;\n  }\n\n  function GoogleButton({\n    isclosed\n  }) {\n    const responseGoogle = response => {\n      console.log('responseGoogle');\n      setUser(response.profileObj);\n      const user = {\n        image: response.profileObj.imageUrl,\n        email: response.profileObj.email,\n        name: response.profileObj.name\n      };\n      setEmail(user.email);\n      cookie.set('user_logged', user, {\n        path: '/'\n      });\n      cookie.set('access_token', JSON.stringify(response.accessToken), {\n        path: '/'\n      });\n      authDispatch({\n        type: 'SIGNIN_SUCCESS'\n      });\n      setClosed(true);\n    };\n\n    return /*#__PURE__*/_jsxDEV(GoogleLogin, {\n      clientId: cookie.get('suscriptor').token_google,\n      render: renderProps => /*#__PURE__*/_jsxDEV(Button, {\n        onClick: renderProps.onClick,\n        disabled: renderProps.disabled,\n        variant: \"primary\",\n        size: \"big\",\n        style: {\n          width: '100%'\n        },\n        children: \"Ingresar con Google\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 11\n      }, this),\n      buttonText: \"Login\",\n      onSuccess: responseGoogle,\n      onFailure: responseGoogle,\n      cookiePolicy: 'single_host_origin'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 9\n    }, this);\n  }\n\n  const toggleForgotPassForm = () => {\n    authDispatch({\n      type: 'FORGOTPASS'\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Heading, {\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"welcomeBack\",\n          defaultMessage: \"Welcome Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SubHeading, {\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"loginText\",\n          defaultMessage: \"Login with your email & password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(GoogleButton, {\n        isclosed: closed\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 8\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(OfferSection, {\n      children: /*#__PURE__*/_jsxDEV(Offer, {\n        children: [/*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"forgotPasswordText\",\n          defaultMessage: \"Forgot your password?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 11\n        }, this), ' ', /*#__PURE__*/_jsxDEV(LinkButton, {\n          onClick: toggleForgotPassForm,\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"resetText\",\n            defaultMessage: \"Reset It\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 188,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/sebastian/space/web/packages/shop-restaurant/src/features/authentication-form/login.tsx"],"names":["React","useEffect","useContext","useState","LinkButton","Button","Wrapper","Container","Heading","SubHeading","OfferSection","Offer","AuthContext","FormattedMessage","closeModal","useQuery","useMutation","GET_CLIENTE_USERNAME","GET_ABANDONADOS","ADD_CLIENTE","ADD_VISITA","GoogleLogin","Cookies","useRouter","localforage","SignInModal","cid","authDispatch","id","setId","user","setUser","closed","setClosed","email","setEmail","customerid","setCustomerid","addVisita","addCliente","data","data2","loading","error","error2","cookie","router","carrito","setCarrito","console","log","get","getItem","LoadCarritoAbandonado","variables","clientid","carritos_abandonados","length","setItem","data_json","push","LoadUser","username","cliente","set","insert_cliente","returning","GoogleButton","isclosed","responseGoogle","response","profileObj","image","imageUrl","name","path","JSON","stringify","accessToken","type","token_google","renderProps","onClick","disabled","width","toggleForgotPassForm"],"mappings":"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","sourcesContent":["import React, { useEffect,  useContext, useState } from 'react';\nimport {\n  LinkButton,\n  Button, \n  Wrapper,\n  Container, \n  Heading,\n  SubHeading,\n  OfferSection,\n  Offer,  \n} from './authentication-form.style'; \nimport { AuthContext } from 'contexts/auth/auth.context';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { closeModal } from '@redq/reuse-modal'; \nimport { useQuery,useMutation } from '@apollo/client';\nimport { GET_CLIENTE_USERNAME } from '../../utils/graphql/query/clients.query';\nimport { GET_ABANDONADOS } from '../../utils/graphql/query/abandonados.query';\nimport { ADD_CLIENTE } from '../../utils/graphql/mutation/register_client';\nimport { ADD_VISITA } from '../../utils/graphql/mutation/visitas';\nimport GoogleLogin from 'react-google-login'; \nimport Cookies  from 'universal-cookie';\nimport { useRouter } from 'next/router';\nimport localforage from 'localforage';\n\nexport default function SignInModal({cid}) {  \n  const { authDispatch } = useContext<any>(AuthContext);\n  const [id, setId] = React.useState(0); \n\n  const [user, setUser] = React.useState(null);\n  const [closed, setClosed] = React.useState(false);\n  const [email, setEmail] = React.useState(''); \n  const [customerid, setCustomerid] = React.useState(0); \n  const [addVisita] = useMutation(ADD_VISITA );\n  const [addCliente,{ data:data2, loading, error:error2 }] = useMutation(ADD_CLIENTE );\n  const cookie = new Cookies();\n \n  const router = useRouter();\n  const [carrito, setCarrito] = useState('')\n\n  useEffect(()=> {\n    console.log('cookie', cookie.get('user_logged'))\n    console.log('localforage', localforage.getItem('@session'))\n \n  },[cookie,localforage])\n\n   // Ingresando function de carga de Carrito Abandonado  \n   function LoadCarritoAbandonado({customerid}){\n\n    console.log('....... 1')  \n    console.log('....... 1.1 ', 'customerid:', customerid)  \n    let { data } =  useQuery(GET_ABANDONADOS, {\n      variables: {\n        clientid: cid,\n        customerid: customerid\n      } \n    });\n    console.log('....... 2')  \n    if ( data && data.carritos_abandonados && data.carritos_abandonados.length > 0 ) {\n       \n        localforage.setItem('@session',data.carritos_abandonados[0].data_json)\n    }\n    console.log('checkout...')\n    if( data &&  data.carritos_abandonados.length > 0 && data.carritos_abandonados[0].data_json !== '' && data.carritos_abandonados[0].data_json !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}')\n      router.push('/')\n\n    return null;\n  } \n     \n\n   \n    function LoadUser ({email}) {\n       \n      let { loading, error, data } = useQuery(GET_CLIENTE_USERNAME, {\n        variables: {\n          clientid: cid,\n          username: email\n        } \n      });\n     \n      if(error) {\n        console.log(error)\n        return <p>Error {error}</p>;\n      }\n      if (loading) {\n        \n        return <p>Loading ...</p>;\n      } \n      console.log('data:',data)\n      if ( data && data.cliente && data.cliente.length > 0 ) {\n        setCustomerid(data.cliente[0].id)\n        \n        console.log(',,,,',customerid)\n         addVisita({\n           variables: {\n                     cliente: customerid, \n                     clientid: cid\n                   }\n         });\n        cookie.set('customer', data.cliente[0])\n        \n        closeModal(); \n      } else {\n        console.log('loadUser else')\n\n        console.log('loadUser email ', email)\n        \n        if( id === 0) \n        {\n          try{\n\n          \n            addCliente({\n              variables: { \n                        username: email, \n                        clientid: cid\n                      }\n            });  \n\n          } catch( error ){\n            console.log(error)\n          }\n        } \n        if( data2 && id === 0) \n        {\n        \n          cookie.set('customer', data2.insert_cliente.returning[0].id)\n          setId(data2.insert_cliente.returning[0].id)        \n          if(cookie.get('login') === '2'){\n            router.push('/checkout')\n          } \n          closeModal(); \n        } \n      }\n\n     return null;\n    }\n\n  \n\n\n    function GoogleButton ({isclosed}) {\n    \n      const responseGoogle = (response) => {\n            console.log('responseGoogle');\n           setUser(response.profileObj); \n           const user = {\n             image: response.profileObj.imageUrl,\n             email: response.profileObj.email,\n             name: response.profileObj.name\n           }\n           setEmail(user.email);            \n           cookie.set('user_logged', user,{path: '/'})\n           cookie.set('access_token', JSON.stringify(response.accessToken),{path: '/'})\n           authDispatch({ type: 'SIGNIN_SUCCESS' });  \n\n          setClosed(true)\n      }\n    \n     return (\n        <GoogleLogin\n        clientId={cookie.get('suscriptor').token_google}\n        render={renderProps => (\n          <Button onClick={renderProps.onClick} disabled={renderProps.disabled} variant='primary'\n          size='big'\n          style={{ width: '100%' }} >Ingresar con Google</Button>\n         \n        )}\n        buttonText=\"Login\"\n        onSuccess={responseGoogle}\n        onFailure={responseGoogle}\n        cookiePolicy={'single_host_origin'}\n      />);\n\n     \n    \n    }\n   \n\n  const toggleForgotPassForm = () => {\n    authDispatch({\n      type: 'FORGOTPASS',\n    });\n  };\n\n  \n  return (\n   \n    <Wrapper>\n      <Container>\n        <Heading>\n          <FormattedMessage id='welcomeBack' defaultMessage='Welcome Back' />\n        </Heading>\n\n        <SubHeading>\n          <FormattedMessage\n            id='loginText'\n            defaultMessage='Login with your email &amp; password'\n          />\n        </SubHeading>\n         \n\n       <GoogleButton isclosed={closed} />\n        \n{/*     {closed && ( <LoadUser email={email}/> )} */}\n\n    {/*    {closed && ( <LoadCarritoAbandonado customerid={328}/> )}   */}\n \n      </Container>\n\n      <OfferSection>\n        <Offer>\n          <FormattedMessage\n            id='forgotPasswordText'\n            defaultMessage='Forgot your password?'\n          />{' '}\n          <LinkButton onClick={toggleForgotPassForm}>\n            <FormattedMessage id='resetText' defaultMessage='Reset It' />\n          </LinkButton>\n        </Offer>\n      </OfferSection>\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}