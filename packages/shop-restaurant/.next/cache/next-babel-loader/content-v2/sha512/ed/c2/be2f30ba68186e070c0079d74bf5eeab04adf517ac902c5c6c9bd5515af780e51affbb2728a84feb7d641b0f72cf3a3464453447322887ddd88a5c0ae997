{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/sebastian/space/web/packages/shop-restaurant/src/layouts/header/mobile-drawer.tsx\";\nimport React, { useContext } from 'react';\nimport { openModal } from '@redq/reuse-modal';\nimport Router from 'next/router';\nimport { FormattedMessage } from 'react-intl';\nimport { Scrollbar } from 'components/scrollbar/scrollbar';\nimport Drawer from 'components/drawer/drawer';\nimport { Button } from 'components/button/button';\nimport NavLink from 'components/nav-link/nav-link';\nimport { CloseIcon } from 'assets/icons/CloseIcon';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport AuthenticationForm from 'features/authentication-form';\nimport Cookies from 'universal-cookie';\nimport localForage from 'localforage';\nimport { DrawerBody, HamburgerIcon, DrawerContentWrapper, DrawerClose, DrawerProfile, LogoutView, LoginView, UserAvatar, UserDetails, DrawerMenu, DrawerMenuItem, UserOptionMenu } from './header.style';\nimport { MOBILE_DRAWER_MENU, MOBILE_AUTHORIZED_DRAWER_MENU, PROFILE_PAGE } from 'site-settings/site-navigation';\nimport { useAppState, useAppDispatch } from 'contexts/app/app.provider';\nimport { useMutation, useQuery } from '@apollo/client';\nimport { GET_ABANDONADOS } from 'utils/graphql/query/abandonados.query';\nimport { AGREGAR_ABANDONADO } from 'utils/graphql/mutation/abandonados';\nimport { UPGRADE_ABANDONADO } from 'utils/graphql/mutation/abandonados';\n\nconst MobileDrawer = () => {\n  const isDrawerOpen = useAppState('isDrawerOpen');\n  const dispatch = useAppDispatch();\n  const cookie = new Cookies();\n  const cid = cookie.get('clientid');\n  let image = '/user.jpg';\n  let nombre = 'Invitado';\n  let user = null;\n  let access_token = null;\n  const carrito = localForage.getItem('@session');\n  const [insert_abandonado] = useMutation(AGREGAR_ABANDONADO);\n  const [upgrade_abandonado] = useMutation(UPGRADE_ABANDONADO);\n  const {\n    data\n  } = useQuery(GET_ABANDONADOS, {\n    variables: {\n      clientid: cid,\n      customerid: cookie.get('customer') && cookie.get('customer').id\n    }\n  });\n  const {\n    authState: {\n      isAuthenticated\n    },\n    authDispatch\n  } = useContext(AuthContext); // Toggle drawer\n\n  const toggleHandler = React.useCallback(() => {\n    dispatch({\n      type: 'TOGGLE_DRAWER'\n    });\n  }, [dispatch]);\n\n  const push = async () => {\n    await insert_abandonado({\n      variables: {\n        clientid: cid,\n        customerid: cookie.get('customer') && cookie.get('customer').id,\n        data_json: '{}'\n      }\n    });\n  };\n\n  const put = async () => {\n    await upgrade_abandonado({\n      variables: {\n        \"clientid\": cid,\n        \"customerid\": cookie.get('customer') && cookie.get('customer').id,\n        \"data_json\": carrito\n      }\n    });\n  };\n\n  const displayLog = () => {\n    console.log('0101:::::::::::::::::::');\n    console.log('0101:::::::::::::::::::', 'data', data);\n    console.log('0101:::::::::::::::::::', 'customerid', cookie.get('customer').id);\n    console.log('0101:::::::::::::::::::', 'json_data', carrito);\n    console.log('0101:::::::::::::::::::');\n  };\n\n  const handleLogout = async () => {\n    if (false) {\n      displayLog();\n\n      if (data.carritos_abandonados && data.carritos_abandonados.length > 0) {\n        await put();\n      } else {\n        await push();\n      }\n\n      cookie.remove('access_token');\n      cookie.remove('customer');\n      cookie.remove('customerid');\n      cookie.remove('user_logged');\n      authDispatch({\n        type: 'SIGN_OUT'\n      });\n      Router.push('/grocery');\n    }\n  };\n\n  if (isAuthenticated) {\n    if (cookie.get('user_logged')) {\n      user = cookie.get('user_logged');\n      access_token = cookie.get('access_token');\n\n      if (user && access_token) {\n        image = user.image;\n        nombre = user.name;\n      }\n    }\n  }\n\n  const signInOutForm = () => {\n    dispatch({\n      type: 'TOGGLE_DRAWER'\n    });\n    authDispatch({\n      type: 'SIGNIN'\n    });\n    cookie.set('login', 1);\n    openModal({\n      show: true,\n      overlayClassName: 'quick-view-overlay',\n      closeOnClickOutside: true,\n      component: AuthenticationForm,\n      closeComponent: '',\n      config: {\n        enableResizing: false,\n        disableDragging: true,\n        className: 'quick-view-modal',\n        width: 458,\n        height: 'auto'\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(Drawer, {\n    width: \"316px\",\n    drawerHandler: /*#__PURE__*/_jsxDEV(HamburgerIcon, {\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 9\n    }, this),\n    open: isDrawerOpen,\n    toggleHandler: toggleHandler,\n    closeButton: /*#__PURE__*/_jsxDEV(DrawerClose, {\n      children: /*#__PURE__*/_jsxDEV(CloseIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 9\n    }, this),\n    children: /*#__PURE__*/_jsxDEV(DrawerBody, {\n      children: /*#__PURE__*/_jsxDEV(Scrollbar, {\n        className: \"drawer-scrollbar\",\n        children: /*#__PURE__*/_jsxDEV(DrawerContentWrapper, {\n          children: [/*#__PURE__*/_jsxDEV(DrawerProfile, {\n            children: isAuthenticated ? /*#__PURE__*/_jsxDEV(LoginView, {\n              children: [/*#__PURE__*/_jsxDEV(UserAvatar, {\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: image,\n                  alt: nombre\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 190,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 189,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(UserDetails, {\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  children: nombre\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 193,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: cookie.get('customer') && cookie.get('customer').nombre\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 194,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  children: cookie.get('customer') && cookie.get('customer').contacts && cookie.get('customer').contacts.length > 0 && cookie.get('customer').contacts[0].number\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 192,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 188,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(LogoutView, {\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"primary\",\n                onClick: signInOutForm,\n                children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n                  id: \"mobileSignInButtonText\",\n                  defaultMessage: \"join\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 201,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 200,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(DrawerMenu, {\n            children: [isAuthenticated && MOBILE_AUTHORIZED_DRAWER_MENU.map(item => /*#__PURE__*/_jsxDEV(DrawerMenuItem, {\n              children: /*#__PURE__*/_jsxDEV(NavLink, {\n                onClick: toggleHandler,\n                href: item.href,\n                label: item.defaultMessage,\n                intlId: item.id,\n                className: \"drawer_menu_item\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 213,\n                columnNumber: 19\n              }, this)\n            }, item.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 17\n            }, this)), !isAuthenticated && MOBILE_DRAWER_MENU.map(item => /*#__PURE__*/_jsxDEV(DrawerMenuItem, {\n              children: /*#__PURE__*/_jsxDEV(NavLink, {\n                onClick: toggleHandler,\n                href: item.href,\n                label: item.defaultMessage,\n                intlId: item.id,\n                className: \"drawer_menu_item\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 224,\n                columnNumber: 19\n              }, this)\n            }, item.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 17\n            }, this))]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 13\n          }, this), isAuthenticated && /*#__PURE__*/_jsxDEV(UserOptionMenu, {\n            children: [/*#__PURE__*/_jsxDEV(DrawerMenuItem, {\n              children: /*#__PURE__*/_jsxDEV(NavLink, {\n                href: PROFILE_PAGE,\n                label: \"Configuraci\\xF3n de mi cuenta\",\n                className: \"drawer_menu_item\",\n                intlId: \"navlinkAccountSettings\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 238,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 237,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(DrawerMenuItem, {\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                onClick: handleLogout,\n                className: \"drawer_menu_item\",\n                children: /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"logoutBtn\",\n                  children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n                    id: \"navlinkLogout\",\n                    defaultMessage: \"Cerrar sesi\\xF3n\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 248,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 247,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 246,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 245,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 5\n  }, this);\n};\n\nexport default MobileDrawer;","map":{"version":3,"sources":["/Users/sebastian/space/web/packages/shop-restaurant/src/layouts/header/mobile-drawer.tsx"],"names":["React","useContext","openModal","Router","FormattedMessage","Scrollbar","Drawer","Button","NavLink","CloseIcon","AuthContext","AuthenticationForm","Cookies","localForage","DrawerBody","HamburgerIcon","DrawerContentWrapper","DrawerClose","DrawerProfile","LogoutView","LoginView","UserAvatar","UserDetails","DrawerMenu","DrawerMenuItem","UserOptionMenu","MOBILE_DRAWER_MENU","MOBILE_AUTHORIZED_DRAWER_MENU","PROFILE_PAGE","useAppState","useAppDispatch","useMutation","useQuery","GET_ABANDONADOS","AGREGAR_ABANDONADO","UPGRADE_ABANDONADO","MobileDrawer","isDrawerOpen","dispatch","cookie","cid","get","image","nombre","user","access_token","carrito","getItem","insert_abandonado","upgrade_abandonado","data","variables","clientid","customerid","id","authState","isAuthenticated","authDispatch","toggleHandler","useCallback","type","push","data_json","put","displayLog","console","log","handleLogout","carritos_abandonados","length","remove","name","signInOutForm","set","show","overlayClassName","closeOnClickOutside","component","closeComponent","config","enableResizing","disableDragging","className","width","height","contacts","number","map","item","href","defaultMessage"],"mappings":"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","sourcesContent":["import React, { useContext } from 'react';\nimport { openModal } from '@redq/reuse-modal';\nimport Router from 'next/router';\nimport { FormattedMessage } from 'react-intl';\nimport { Scrollbar } from 'components/scrollbar/scrollbar';\nimport Drawer from 'components/drawer/drawer';\nimport { Button } from 'components/button/button';\nimport NavLink from 'components/nav-link/nav-link';\nimport { CloseIcon } from 'assets/icons/CloseIcon';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport AuthenticationForm from 'features/authentication-form';\nimport Cookies  from 'universal-cookie';\nimport localForage from 'localforage';\n \n\nimport {\n  DrawerBody,\n  HamburgerIcon,\n  DrawerContentWrapper,\n  DrawerClose,\n  DrawerProfile,\n  LogoutView,\n  LoginView,\n  UserAvatar,\n  UserDetails,\n  DrawerMenu,\n  DrawerMenuItem,\n  UserOptionMenu,\n} from './header.style';\nimport UserImage from 'assets/images/user.jpg';\nimport {\n  MOBILE_DRAWER_MENU,\n  MOBILE_AUTHORIZED_DRAWER_MENU,\n  PROFILE_PAGE,\n  YOUR_ORDER_PAGE,\n} from 'site-settings/site-navigation';\nimport { useAppState, useAppDispatch } from 'contexts/app/app.provider';\nimport { useMutation, useQuery } from '@apollo/client';\nimport { GET_ABANDONADOS } from 'utils/graphql/query/abandonados.query';\nimport { AGREGAR_ABANDONADO } from 'utils/graphql/mutation/abandonados';\nimport { UPGRADE_ABANDONADO } from 'utils/graphql/mutation/abandonados';\n\n\nconst MobileDrawer: React.FunctionComponent = () => {\n  const isDrawerOpen = useAppState('isDrawerOpen');\n  const dispatch = useAppDispatch();\n  const cookie = new Cookies();\n  const cid = cookie.get('clientid')  \n  let image='/user.jpg';\n  let nombre='Invitado';\n  let user = null\n  let access_token  = null\n  const carrito = localForage.getItem('@session');\n  const [insert_abandonado] = useMutation(AGREGAR_ABANDONADO); \n  const [upgrade_abandonado] = useMutation(UPGRADE_ABANDONADO); \n\n  const { data } = useQuery(\n    GET_ABANDONADOS,\n    {\n      variables: { \n        clientid: cid,\n        customerid: cookie.get('customer') &&  cookie.get('customer').id\n      }\n    }\n  );\n\n  const {\n    authState: { isAuthenticated },\n    authDispatch,\n  } = useContext<any>(AuthContext);\n  // Toggle drawer\n  const toggleHandler = React.useCallback(() => {\n    dispatch({\n      type: 'TOGGLE_DRAWER',\n    });\n  }, [dispatch]);\n \n   const push = async () => {\n    await insert_abandonado({\n      variables: { \n        clientid: cid,\n        customerid: cookie.get('customer') && cookie.get('customer').id,\n        data_json: '{}'\n      },\n  });  \n  }\n\n  const put = async () => {\n    await upgrade_abandonado({\n      variables: { \n        \"clientid\": cid,\n        \"customerid\": cookie.get('customer') && cookie.get('customer').id,\n        \"data_json\": carrito\n      },\n  });  \n  }\n\n  const displayLog = () =>{ \n     console.log('0101:::::::::::::::::::')\n     console.log('0101:::::::::::::::::::','data',data )\n     console.log('0101:::::::::::::::::::','customerid',cookie.get('customer').id )\n     console.log('0101:::::::::::::::::::','json_data',carrito )\n     console.log('0101:::::::::::::::::::')\n  }\n\n\n  const handleLogout = async () => {\n     \n    if (typeof window !== 'undefined') {\n      \n    displayLog()\n\n     if ( data.carritos_abandonados && data.carritos_abandonados.length > 0 ) {\n        await put()\n     } else { \n        await push()\n     }  \n      cookie.remove('access_token');\n      cookie.remove('customer'); \n      cookie.remove('customerid'); \n      cookie.remove('user_logged');\n      authDispatch({ type: 'SIGN_OUT' });\n      Router.push('/grocery');\n    }\n  };\n\n  if(isAuthenticated){\n    if( cookie.get('user_logged') ){\n      user = cookie.get('user_logged')\n      access_token = cookie.get('access_token')\n\n      if(user && access_token)  {\n          image =   user.image;\n          nombre = user.name; \n      }\n    }\n  }\n   \n\n  const signInOutForm = () => {\n    dispatch({\n      type: 'TOGGLE_DRAWER',\n    });\n\n    authDispatch({\n      type: 'SIGNIN',\n    });\n    cookie.set('login',1)\n    openModal({\n      show: true,\n      overlayClassName: 'quick-view-overlay',\n      closeOnClickOutside: true,\n      component: AuthenticationForm,\n      closeComponent: '',\n      config: {\n        enableResizing: false,\n        disableDragging: true,\n        className: 'quick-view-modal',\n        width: 458,\n        height: 'auto',\n      },\n    });\n  };\n\n  return (\n    <Drawer\n      width='316px'\n      drawerHandler={\n        <HamburgerIcon>\n          <span />\n          <span />\n          <span />\n        </HamburgerIcon>\n      }\n      open={isDrawerOpen}\n      toggleHandler={toggleHandler}\n      closeButton={\n        <DrawerClose>\n          <CloseIcon />\n        </DrawerClose>\n      }\n    >\n      <DrawerBody>\n        <Scrollbar className='drawer-scrollbar'>\n          <DrawerContentWrapper>\n            <DrawerProfile>\n              {isAuthenticated ? (\n                <LoginView>\n                  <UserAvatar>\n                      <img src={image} alt={nombre} />\n                  </UserAvatar>\n                  <UserDetails>\n                    <h3>{nombre}</h3>\n                    <span>{cookie.get('customer') && cookie.get('customer').nombre}</span>\n                    <span>{cookie.get('customer') && cookie.get('customer').contacts && cookie.get('customer').contacts.length > 0 && cookie.get('customer').contacts[0].number}</span>\n                  </UserDetails>\n                </LoginView>\n              ) : (\n                <LogoutView>\n                  <Button variant='primary' onClick={signInOutForm}>\n                    <FormattedMessage\n                      id='mobileSignInButtonText'\n                      defaultMessage='join'\n                    />\n                  </Button>\n                </LogoutView>\n              )}\n            </DrawerProfile>\n\n            <DrawerMenu>\n              {isAuthenticated && MOBILE_AUTHORIZED_DRAWER_MENU.map((item) => (\n                <DrawerMenuItem key={item.id}>\n                  <NavLink\n                    onClick={toggleHandler}\n                    href={item.href}\n                    label={item.defaultMessage}\n                    intlId={item.id}\n                    className='drawer_menu_item'\n                  />\n                </DrawerMenuItem>\n              ))}\n               {!isAuthenticated && MOBILE_DRAWER_MENU.map((item) => (\n                <DrawerMenuItem key={item.id}>\n                  <NavLink\n                    onClick={toggleHandler}\n                    href={item.href}\n                    label={item.defaultMessage}\n                    intlId={item.id}\n                    className='drawer_menu_item'\n                  />\n                </DrawerMenuItem>\n              ))}\n            </DrawerMenu>\n\n            {isAuthenticated && (\n              <UserOptionMenu>\n                <DrawerMenuItem>\n                  <NavLink\n                    href={PROFILE_PAGE}\n                    label='Configuración de mi cuenta'\n                    className='drawer_menu_item'\n                    intlId='navlinkAccountSettings'\n                  />\n                </DrawerMenuItem>\n                <DrawerMenuItem>\n                  <div onClick={handleLogout} className='drawer_menu_item'>\n                    <span className='logoutBtn'>\n                      <FormattedMessage\n                        id='navlinkLogout'\n                        defaultMessage='Cerrar sesión'\n                      />\n                    </span>\n                  </div>\n                </DrawerMenuItem>\n              </UserOptionMenu>\n            )}\n          </DrawerContentWrapper>\n        </Scrollbar>\n      </DrawerBody>\n    </Drawer>\n  );\n};\n\nexport default MobileDrawer;\n"]},"metadata":{},"sourceType":"module"}