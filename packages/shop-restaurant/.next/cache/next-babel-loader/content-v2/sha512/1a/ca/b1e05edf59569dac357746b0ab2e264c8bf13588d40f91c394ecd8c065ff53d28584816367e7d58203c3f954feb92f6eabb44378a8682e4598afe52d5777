{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/sebastian/space/web/packages/shop-restaurant/src/features/authentication-form/login.tsx\";\nimport React, { useEffect, useContext, useState } from 'react';\nimport { LinkButton, IconWrapper, Button, Wrapper, Container, Heading, SubHeading, OfferSection, Offer, Divider } from './authentication-form.style';\nimport { openModal } from '@redq/reuse-modal';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { closeModal } from '@redq/reuse-modal';\nimport { useQuery, useMutation } from '@apollo/client';\nimport { GET_CLIENTE_USERNAME } from '../../utils/graphql/query/clients.query';\nimport { GET_ABANDONADOS } from '../../utils/graphql/query/abandonados.query';\nimport { ADD_CLIENTE } from '../../utils/graphql/mutation/register_client';\nimport { ADD_VISITA } from '../../utils/graphql/mutation/visitas';\nimport GoogleLogin from 'react-google-login';\nimport Cookies from 'universal-cookie';\nimport { useRouter } from 'next/router';\nimport localforage from 'localforage';\nimport { Input } from 'components/forms/input';\nimport SignOutModal from './register';\nimport { Google } from 'assets/icons/google';\nexport default function SignInModal({\n  cid\n}) {\n  const cookie = new Cookies();\n  const intl = useIntl();\n  const {\n    authState: {\n      isAuthenticated\n    },\n    authDispatch\n  } = useContext(AuthContext);\n  const [id, setId] = React.useState(0);\n  const [password, setPassword] = React.useState('');\n  const [user, setUser] = React.useState(null);\n  const [closed, setClosed] = React.useState(false);\n  const [email, setEmail] = React.useState('');\n  const [imageURL, setImageURL] = React.useState(null);\n  const [nombre, setNombre] = React.useState(null);\n  const [addVisita] = useMutation(ADD_VISITA);\n  const router = useRouter();\n  const {\n    0: carrito,\n    1: setCarrito\n  } = useState('');\n  const {\n    0: registered,\n    1: setRegistered\n  } = useState(false);\n  const [addCliente, {\n    data: data2,\n    error,\n    loading\n  }] = useMutation(ADD_CLIENTE);\n  const {\n    data: data1,\n    networkStatus\n  } = useQuery(GET_CLIENTE_USERNAME, {\n    variables: {\n      clientid: cid,\n      username: email\n    }\n  });\n\n  const loadCliente = () => {\n    // alert('loadCliente email '  + email + \" \" + cid + \" data1: \" + JSON.stringify(data1))\n    // alert('ULALA==========================')\n    if (data1 && data1.cliente && data1.cliente.length > 0) {\n      // alert('cambiando a true registered')\n      setRegistered(true); // alert('!!!!!!!!!!! usuario encontradoxx ' + JSON.stringify(data1))   \n\n      setId(data1.cliente[0].id);\n      cookie.set('customer', data1.cliente[0]);\n      closeModal();\n    } else {\n      if (email !== null && imageURL !== null && nombre !== null && registered === false && isAuthenticated) {\n        if (registered === false) {\n          agregarCliente();\n          setRegistered(true);\n        }\n      }\n    }\n  };\n\n  const agregarCliente = async () => {\n    const res = await addCliente({\n      variables: {\n        username: email,\n        clientid: cid,\n        imageURL: imageURL,\n        nombre: nombre\n      }\n    });\n\n    if (res.data && res.data.insert_cliente && res.data.insert_cliente.returning.length > 0) {\n      // alert('ENTRO !!!!!!!!!!!!! AL  DATA2')\n      setId(res.data.insert_cliente.returning[0].id);\n      let customer = {\n        id: id,\n        nombre: nombre,\n        contacto: null,\n        direcciones: null,\n        contactos: null,\n        imageURL: imageURL,\n        payments: null,\n        username: email,\n        addresses: null,\n        contacts: null\n      };\n      cookie.set('customer', customer);\n      cookie.set('customerid', res.data.insert_cliente.returning[0].id); // alert('usuario creado ' + res.data.insert_cliente.returning[0].id)\n\n      if (cookie.get('login') === 2) {\n        router.push('/checkout');\n      }\n    }\n  };\n\n  useEffect(() => {\n    loadCliente();\n  }, [email, data2, cookie]);\n\n  function GoogleButton({\n    isclosed\n  }) {\n    const responseGoogle = response => {\n      setUser(response.profileObj);\n      const user = {\n        image: response.profileObj.imageUrl,\n        email: response.profileObj.email,\n        name: response.profileObj.name\n      };\n      setEmail(user.email);\n      setImageURL(user.image);\n      setNombre(user.name); //////////////////////////////////\n\n      cookie.set('user_logged', user, {\n        path: '/'\n      });\n      cookie.set('access_token', JSON.stringify(response.accessToken), {\n        path: '/'\n      });\n      setClosed(true);\n      authDispatch({\n        type: 'SIGNIN_SUCCESS'\n      });\n    };\n\n    const failureGoogle = response => {\n      // alert('fallo la wea ' + JSON.stringify(response))\n      console.log('failureGoogle'); //authDispatch({ type: 'SIGN_OUT' });  \n      //setClosed(true)\n    };\n\n    return /*#__PURE__*/_jsxDEV(GoogleLogin, {\n      clientId: cookie.get('suscriptor').token_google,\n      render: renderProps => /*#__PURE__*/_jsxDEV(Button, {\n        onClick: renderProps.onClick,\n        disabled: renderProps.disabled,\n        variant: \"primary\",\n        size: \"big\",\n        style: {\n          width: '100%',\n          backgroundColor: '#4285f4'\n        },\n        children: [/*#__PURE__*/_jsxDEV(IconWrapper, {\n          children: /*#__PURE__*/_jsxDEV(Google, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 180,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"continueGoogleBtn\",\n          defaultMessage: \"Continue with Google\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }, this),\n      buttonText: \"Login\",\n      onSuccess: responseGoogle,\n      onFailure: failureGoogle,\n      cookiePolicy: 'single_host_origin'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 9\n    }, this);\n  } // Ingresando function de carga de Carrito Abandonado  \n\n\n  function LoadCarritoAbandonado({\n    customerid\n  }) {\n    console.log('....... 1');\n    console.log('....... 1.1 ', 'customerid:', customerid);\n    let {\n      data\n    } = useQuery(GET_ABANDONADOS, {\n      variables: {\n        clientid: cid,\n        customerid: customerid\n      }\n    });\n    console.log('....... 2');\n\n    if (data && data.carritos_abandonados && data.carritos_abandonados.length > 0) {\n      localforage.setItem('@session', data.carritos_abandonados[0].data_json);\n    }\n\n    console.log('checkout...');\n    if (data && data.carritos_abandonados.length > 0 && data.carritos_abandonados[0].data_json !== '' && data.carritos_abandonados[0].data_json !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}') router.push('/');\n    return null;\n  }\n\n  const handleSubmit = () => {\n    alert(1);\n  };\n\n  const handleRegister = () => {\n    openModal({\n      show: true,\n      overlayClassName: 'quick-view-overlay',\n      closeOnClickOutside: true,\n      component: SignOutModal,\n      closeComponent: '',\n      config: {\n        enableResizing: false,\n        disableDragging: true,\n        className: 'quick-view-modal',\n        width: 558,\n        height: 'auto'\n      }\n    });\n  };\n\n  const toggleForgotPassForm = () => {\n    authDispatch({\n      type: 'FORGOTPASS'\n    });\n  };\n\n  return !closed && /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Heading, {\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"welcomeBack\",\n          defaultMessage: \"Welcome Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SubHeading, {\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"loginText\",\n          defaultMessage: \"Login with your email & password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"email\",\n        placeholder: intl.formatMessage({\n          id: 'emailAddressPlaceholder',\n          defaultMessage: 'correo electrónico o Teléfono de contacto'\n        }),\n        onChange: e => setEmail(e.target.value),\n        required: true,\n        height: \"48px\",\n        backgroundColor: \"#F7F7F7\",\n        mb: \"10px\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        type: \"password\",\n        placeholder: intl.formatMessage({\n          id: 'passwordPlaceholder',\n          defaultMessage: 'Password (min 6 characters)'\n        }),\n        onChange: e => setPassword(e.target.value),\n        required: true,\n        height: \"48px\",\n        backgroundColor: \"#F7F7F7\",\n        mb: \"10px\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 283,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 11\n      }, this), ' ', /*#__PURE__*/_jsxDEV(Button, {\n        type: \"button\",\n        variant: \"primary\",\n        onClick: handleSubmit,\n        size: \"big\",\n        loading: loading,\n        style: {\n          width: '100%'\n        },\n        children: \"Ingresar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Divider, {\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"orText\",\n            defaultMessage: \"or\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(GoogleButton, {\n        isclosed: closed\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 8\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 8\n      }, this), ' ', /*#__PURE__*/_jsxDEV(Button, {\n        type: \"button\",\n        variant: \"black\",\n        onClick: handleRegister,\n        size: \"big\",\n        loading: loading,\n        style: {\n          width: '100%'\n        },\n        children: \"Registrar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 19\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 5\n      }, this), ' ', /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 5\n      }, this), ' ']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(OfferSection, {\n      children: /*#__PURE__*/_jsxDEV(Offer, {\n        children: [/*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"forgotPasswordText\",\n          defaultMessage: \"Forgot your password?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 11\n        }, this), ' ', /*#__PURE__*/_jsxDEV(LinkButton, {\n          onClick: toggleForgotPassForm,\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"resetText\",\n            defaultMessage: \"Reset It\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 256,\n    columnNumber: 17\n  }, this);\n}","map":{"version":3,"sources":["/Users/sebastian/space/web/packages/shop-restaurant/src/features/authentication-form/login.tsx"],"names":["React","useEffect","useContext","useState","LinkButton","IconWrapper","Button","Wrapper","Container","Heading","SubHeading","OfferSection","Offer","Divider","openModal","AuthContext","FormattedMessage","useIntl","closeModal","useQuery","useMutation","GET_CLIENTE_USERNAME","GET_ABANDONADOS","ADD_CLIENTE","ADD_VISITA","GoogleLogin","Cookies","useRouter","localforage","Input","SignOutModal","Google","SignInModal","cid","cookie","intl","authState","isAuthenticated","authDispatch","id","setId","password","setPassword","user","setUser","closed","setClosed","email","setEmail","imageURL","setImageURL","nombre","setNombre","addVisita","router","carrito","setCarrito","registered","setRegistered","addCliente","data","data2","error","loading","data1","networkStatus","variables","clientid","username","loadCliente","cliente","length","set","agregarCliente","res","insert_cliente","returning","customer","contacto","direcciones","contactos","payments","addresses","contacts","get","push","GoogleButton","isclosed","responseGoogle","response","profileObj","image","imageUrl","name","path","JSON","stringify","accessToken","type","failureGoogle","console","log","token_google","renderProps","onClick","disabled","width","backgroundColor","LoadCarritoAbandonado","customerid","carritos_abandonados","setItem","data_json","handleSubmit","alert","handleRegister","show","overlayClassName","closeOnClickOutside","component","closeComponent","config","enableResizing","disableDragging","className","height","toggleForgotPassForm","formatMessage","defaultMessage","e","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect,  useContext, useState } from 'react';\nimport {\n  LinkButton,\n  IconWrapper,\n  Button, \n  Wrapper,\n  Container, \n  Heading,\n  SubHeading,\n  OfferSection,\n  Offer,\n  Divider,  \n} from './authentication-form.style'; \nimport { openModal } from '@redq/reuse-modal';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { closeModal } from '@redq/reuse-modal'; \nimport { useQuery,useMutation } from '@apollo/client';\nimport { GET_CLIENTE_USERNAME } from '../../utils/graphql/query/clients.query';\nimport { GET_ABANDONADOS } from '../../utils/graphql/query/abandonados.query';\nimport { ADD_CLIENTE } from '../../utils/graphql/mutation/register_client';\nimport { ADD_VISITA } from '../../utils/graphql/mutation/visitas';\nimport GoogleLogin from 'react-google-login'; \nimport Cookies  from 'universal-cookie';\nimport { useRouter } from 'next/router';\nimport localforage from 'localforage';\nimport { Input } from 'components/forms/input';\nimport { SpaceBar } from '@material-ui/icons';\nimport SignOutModal from './register';\nimport { Google } from 'assets/icons/google';\n\nexport default function SignInModal({cid}) {  \n\n \n\n  const cookie = new Cookies();\n  const intl = useIntl();\n  const { authState: { isAuthenticated }, authDispatch } = useContext<any>(AuthContext);\n  const [id, setId] = React.useState(0); \n  const [password, setPassword] = React.useState('');\n  const [user, setUser] = React.useState(null);\n  const [closed, setClosed] = React.useState(false);\n  const [email, setEmail]  =  React.useState('');\n  const [imageURL, setImageURL] = React.useState(null); \n  const [nombre, setNombre] = React.useState(null);\n  const [addVisita] = useMutation(ADD_VISITA );\n  \n  const router = useRouter();\n  const [carrito, setCarrito] = useState('')\n  const [registered, setRegistered] = useState(false)\n\n \n  const [addCliente, {data:data2 , error, loading} ] = useMutation(ADD_CLIENTE );\n  \n\n  const { data:data1, networkStatus } = useQuery(GET_CLIENTE_USERNAME, {\n    variables: {\n      clientid: cid,\n      username: email\n    } \n  });\n\n  const loadCliente = () => {\n   \n\n    // alert('loadCliente email '  + email + \" \" + cid + \" data1: \" + JSON.stringify(data1))\n    \n      // alert('ULALA==========================')\n      if(data1 && data1.cliente && data1.cliente.length > 0 ){\n        // alert('cambiando a true registered')\n        setRegistered(true)\n        // alert('!!!!!!!!!!! usuario encontradoxx ' + JSON.stringify(data1))   \n        setId(data1.cliente[0].id)\n        cookie.set('customer', data1.cliente[0])\n        closeModal(); \n      }else{\n        if( email !== null &&  imageURL !== null &&  nombre !== null && registered === false && isAuthenticated ) {\n\n          if( registered === false ){\n    \n              agregarCliente();\n             \n              setRegistered(true)\n          }\n        \n        }  \n      } \n\n  }\n   \n  const agregarCliente = async () => {\n\n    const res = await addCliente({\n      variables: { \n                username: email, \n                clientid: cid,\n                imageURL: imageURL,\n                nombre: nombre\n              }\n    });\n\n    \n      if(res.data && res.data.insert_cliente && res.data.insert_cliente.returning.length > 0) {\n               // alert('ENTRO !!!!!!!!!!!!! AL  DATA2')\n                setId(res.data.insert_cliente.returning[0].id)   \n                \n                let customer = {\n                  id: id,\n                  nombre: nombre,\n                  contacto: null,\n                  direcciones: null,\n                  contactos: null,\n                  imageURL: imageURL,\n                  payments: null,\n                  username: email,\n                  addresses: null,\n                  contacts: null\n                }\n                cookie.set('customer', customer);\n                cookie.set('customerid', res.data.insert_cliente.returning[0].id)\n                // alert('usuario creado ' + res.data.insert_cliente.returning[0].id)\n                 \n                if(cookie.get('login') === 2){\n                  router.push('/checkout')\n                } \n              \n          }  \n  }\n\n\n  useEffect(()=> {\n    \n    loadCliente();\n    \n   \n \n  },[ email, data2, cookie])\n \n\n\n    function GoogleButton ({isclosed}) {\n \n      const responseGoogle = (response) => {  \n           setUser(response.profileObj); \n           const user = {\n             image: response.profileObj.imageUrl,\n             email: response.profileObj.email,\n             name: response.profileObj.name\n           } \n           setEmail(user.email);\n           setImageURL(user.image);\n           setNombre(user.name); \n           //////////////////////////////////\n           cookie.set('user_logged', user,{path: '/'})\n           cookie.set('access_token', JSON.stringify(response.accessToken),{path: '/'})\n           setClosed(true)\n           authDispatch({ type: 'SIGNIN_SUCCESS' });  \n          \n         \n      }\n\n      const failureGoogle = (response) => {\n        // alert('fallo la wea ' + JSON.stringify(response))\n        console.log('failureGoogle');\n        //authDispatch({ type: 'SIGN_OUT' });  \n        //setClosed(true)\n      }\n    \n     return (\n        <GoogleLogin \n        clientId={cookie.get('suscriptor').token_google}\n        render={renderProps => (\n          <Button\n          onClick={renderProps.onClick} \n          disabled={renderProps.disabled} \n          variant='primary'\n          size='big'\n          style={{ width: '100%', backgroundColor: '#4285f4' }}\n        >\n          <IconWrapper>\n            <Google />\n          </IconWrapper>\n          <FormattedMessage\n            id='continueGoogleBtn'\n            defaultMessage='Continue with Google'\n          />\n        </Button>\n\n\n\n        )}\n        buttonText=\"Login\"\n        onSuccess={responseGoogle}\n        onFailure={failureGoogle}\n        cookiePolicy={'single_host_origin'}\n      />);\n\n     \n    \n    }\n\n    // Ingresando function de carga de Carrito Abandonado  \n   function LoadCarritoAbandonado({customerid}){\n\n    console.log('....... 1')  \n    console.log('....... 1.1 ', 'customerid:', customerid)  \n    let { data } =  useQuery(GET_ABANDONADOS, {\n      variables: {\n        clientid: cid,\n        customerid: customerid\n      } \n    });\n    console.log('....... 2')  \n    if ( data && data.carritos_abandonados && data.carritos_abandonados.length > 0 ) {\n       \n        localforage.setItem('@session',data.carritos_abandonados[0].data_json)\n    }\n    console.log('checkout...')\n    if( data &&  data.carritos_abandonados.length > 0 && data.carritos_abandonados[0].data_json !== '' && data.carritos_abandonados[0].data_json !== '{\\\"isOpen\\\":false,\\\"items\\\":[],\\\"isRestaurant\\\":false,\\\"coupon\\\":null}')\n      router.push('/')\n\n    return null;\n  } \n   \n  const handleSubmit = () => {\n    alert(1)\n  } \n\n  const handleRegister = () => {\n    \n    openModal({\n      show: true,\n      overlayClassName: 'quick-view-overlay',\n      closeOnClickOutside: true,\n      component: SignOutModal,\n      closeComponent: '',\n      config: {\n        enableResizing: false,\n        disableDragging: true,\n        className: 'quick-view-modal',\n        width: 558,\n        height: 'auto',\n      },\n    });\n  } \n\n  const toggleForgotPassForm = () => {\n    authDispatch({\n      type: 'FORGOTPASS',\n    });\n  };\n\n  \n  return (\n   \n    !closed && (<Wrapper>\n      <Container>\n        <Heading>\n          <FormattedMessage id='welcomeBack' defaultMessage='Welcome Back' />\n        </Heading>\n\n        <SubHeading>\n          <FormattedMessage\n            id='loginText'\n            defaultMessage='Login with your email &amp; password'\n          />\n        </SubHeading>\n         \n\n        <Input\n          type='email'\n          placeholder={intl.formatMessage({\n            id: 'emailAddressPlaceholder',\n            defaultMessage: 'correo electrónico o Teléfono de contacto',\n          })}\n          onChange={(e) => setEmail(e.target.value)}\n          required\n          height='48px'\n          backgroundColor='#F7F7F7'\n          mb='10px'\n        />\n         {/*  ingreso de password */}\n        <Input\n          type='password'\n          placeholder={intl.formatMessage({\n            id: 'passwordPlaceholder',\n            defaultMessage: 'Password (min 6 characters)',\n          })}\n          onChange={(e) => setPassword(e.target.value)}\n          required        \n          height='48px'\n          backgroundColor='#F7F7F7'\n          mb='10px'\n        />\n\n          <br />{' '}\n\n\n          <Button\n                  type='button'\n                  variant='primary'\n                  onClick={handleSubmit}\n                  size='big'\n                  loading={loading}\n                  style={{ width: '100%' }}\n                >\n                 Ingresar</Button>\n       <Divider>\n          <span>\n            <FormattedMessage id='orText' defaultMessage='or' />\n          </span>\n        </Divider>\n\n       <GoogleButton isclosed={closed} />\n        \n       <br />{' '}\n\n                  <Button\n                  type='button'\n                  variant='black'\n                  onClick={handleRegister}\n                  size='big'\n                  loading={loading}\n                  style={{ width: '100%' }}\n                >\n                 Registrar</Button>\n\n    {/*     {closed && ( <LoadUser email={email}/> )} */}\n\n    {/*    {closed && ( <LoadCarritoAbandonado customerid={328}/> )}   */}\n\n    <br />{' '}\n    <br />{' '} \n      </Container>\n\n      <OfferSection>\n        <Offer>\n          <FormattedMessage\n            id='forgotPasswordText'\n            defaultMessage='Forgot your password?'\n          />{' '}\n          <LinkButton onClick={toggleForgotPassForm}>\n            <FormattedMessage id='resetText' defaultMessage='Reset It' />\n          </LinkButton>\n        </Offer>\n      </OfferSection>\n    </Wrapper>)\n  );\n}\n"]},"metadata":{},"sourceType":"module"}