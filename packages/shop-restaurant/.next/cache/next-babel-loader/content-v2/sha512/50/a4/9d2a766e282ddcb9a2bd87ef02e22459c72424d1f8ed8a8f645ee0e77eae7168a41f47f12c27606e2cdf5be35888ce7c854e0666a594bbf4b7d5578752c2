{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/alejandrosandoval/space/world_eserp/web/packages/shop-restaurant/src/features/authentication-form/login.tsx\";\nimport React, { useContext } from 'react';\nimport { LinkButton, Button, Wrapper, Container, Heading, SubHeading, OfferSection, Offer // Input,\n, Divider } from './authentication-form.style';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { closeModal } from '@redq/reuse-modal';\nimport { Input } from 'components/forms/input';\nimport { useQuery, useMutation } from '@apollo/client';\nimport { GET_CLIENTE_USERNAME_PASSWORD } from '../../utils/graphql/query/clients.query';\nimport { GET_CLIENTE_USERNAME } from '../../utils/graphql/query/clients.query';\nimport { SET_CLIENTE } from '../../utils/graphql/mutation/register_client';\nimport { ADD_VISITA } from '../../utils/graphql/mutation/visitas';\nimport GoogleLogin from 'react-google-login';\nexport default function SignInModal({\n  cid\n}) {\n  const intl = useIntl();\n  const {\n    authDispatch\n  } = useContext(AuthContext);\n  const [id, setId] = React.useState(0);\n  const [user, setUser] = React.useState(null);\n  const [email, setEmail] = React.useState('');\n  const [password, setPassword] = React.useState('');\n  const [addVisita] = useMutation(ADD_VISITA);\n  const [setCliente] = useMutation(SET_CLIENTE);\n  const {\n    data,\n    error,\n    loading\n  } = useQuery(GET_CLIENTE_USERNAME_PASSWORD, {\n    variables: {\n      clientid: cid,\n      username: email,\n      password: password\n    }\n  });\n  const {\n    data: data1,\n    loading: loading1\n  } = useQuery(GET_CLIENTE_USERNAME, {\n    variables: {\n      clientid: cid,\n      username: email\n    }\n  });\n\n  function GoogleButton() {\n    const responseGoogle = response => {\n      console.log(response.data);\n      setUser(response.data.profileObj);\n      localStorage.setItem('user_logged', JSON.stringify(response.data.profileObj));\n      localStorage.setItem('access_token', JSON.stringify(response.data.accessToken));\n      authDispatch({\n        type: 'SIGNIN_SUCCESS'\n      });\n      setEmail(JSON.stringify(user.email));\n      closeModal();\n    };\n\n    return /*#__PURE__*/_jsxDEV(GoogleLogin, {\n      clientId: '13854964639-ie0g4ejmkg7fa4e2gb0b2t7hci0b27u0.apps.googleusercontent.com',\n      render: renderProps => /*#__PURE__*/_jsxDEV(\"button\", {\n        variant: \"green\",\n        id: \"primary\",\n        onClick: renderProps.onClick,\n        disabled: renderProps.disabled,\n        children: \"This is my custom Google button\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 11\n      }, this),\n      buttonText: \"Login\",\n      onSuccess: responseGoogle,\n      onFailure: responseGoogle,\n      cookiePolicy: 'single_host_origin'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 9\n    }, this);\n  }\n\n  const addVisitaUser = () => {\n    if (data1 && data1.cliente.length > 0) {\n      console.log('usuario Encontrado');\n      addVisita({\n        variables: {\n          cliente: data.cliente[0].id,\n          clientid: cid\n        }\n      });\n    }\n\n    ;\n  };\n\n  const setClienteUser = () => {\n    if (data && data.cliente.length > 0) {\n      console.log('usuario Encontrado');\n      setCliente({\n        variables: {\n          clientid: cid,\n          nombre: user.name + ' ' + user.familyName,\n          email: user.email,\n          imageURL: user.photoURL\n        }\n      });\n    }\n\n    ;\n  };\n\n  const toggleSignUpForm = () => {\n    authDispatch({\n      type: 'SIGNUP'\n    });\n  };\n\n  const toggleForgotPassForm = () => {\n    authDispatch({\n      type: 'FORGOTPASS'\n    });\n  };\n\n  const loginCallback = () => {\n    console.log('data...:', JSON.stringify(data)); // validamos username y password\n\n    if (data && data.cliente.length > 0) {\n      console.log('usuario Encontrado');\n      addVisita({\n        variables: {\n          cliente: data.cliente[0].id,\n          clientid: cid\n        }\n      });\n\n      if (false) {\n        localStorage.setItem('access_token', `${data.cliente[0].last_seen}`);\n        localStorage.setItem('user_logged', JSON.stringify(data.cliente[0]));\n        authDispatch({\n          type: 'SIGNIN_SUCCESS'\n        });\n        closeModal();\n      }\n    } else {\n      console.log('usuario NO existe');\n      alert('usuario no encontrado');\n    }\n  };\n  /* const loginGoogleCall = () => { */\n\n  /* console.log('loginGoogleCall:', firebase)\n        console.log('provider:', provider)\n   firebase.auth()\n  .signInWithPopup(provider)\n  .then((result) => {\n  \n    var credential = result.credential;\n    var user = result.user;\n    setEmail(user.email)\n    setCliente({\n      variables: {\n                clientid: cid,\n                nombre: user.displayName,\n                email: user.email,\n                imageURL: user.photoURL  \n              }\n    });\n   \n  \n   \n    */\n\n\n  return /*#__PURE__*/_jsxDEV(Wrapper, {\n    children: [/*#__PURE__*/_jsxDEV(Container, {\n      children: [/*#__PURE__*/_jsxDEV(Heading, {\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"welcomeBack\",\n          defaultMessage: \"Welcome Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(SubHeading, {\n        children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"loginText\",\n          defaultMessage: \"Login with your email & password\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: loginCallback,\n        children: [/*#__PURE__*/_jsxDEV(Input, {\n          type: \"email\",\n          placeholder: intl.formatMessage({\n            id: 'emailAddressPlaceholder',\n            defaultMessage: 'Email Address.'\n          }),\n          value: email,\n          onChange: e => setEmail(e.target.value),\n          required: true,\n          height: \"48px\",\n          backgroundColor: \"#F7F7F7\",\n          mb: \"10px\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Input, {\n          type: \"password\",\n          placeholder: intl.formatMessage({\n            id: 'passwordPlaceholder',\n            defaultMessage: 'Password (min 6 characters)'\n          }),\n          value: password,\n          onChange: e => setPassword(e.target.value),\n          required: true,\n          height: \"48px\",\n          backgroundColor: \"#F7F7F7\",\n          mb: \"10px\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"primary\",\n          size: \"big\",\n          style: {\n            width: '100%'\n          },\n          type: \"submit\",\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"continueBtn\",\n            defaultMessage: \"Continue\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 225,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Divider, {\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"orText\",\n            defaultMessage: \"or\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(GoogleButton, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Offer, {\n        style: {\n          padding: '20px 0'\n        },\n        children: [/*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"dontHaveAccount\",\n          defaultMessage: \"Don't have any account?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this), ' ', /*#__PURE__*/_jsxDEV(LinkButton, {\n          onClick: toggleSignUpForm,\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"signUpBtnText\",\n            defaultMessage: \"Sign Up\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(OfferSection, {\n      children: /*#__PURE__*/_jsxDEV(Offer, {\n        children: [/*#__PURE__*/_jsxDEV(FormattedMessage, {\n          id: \"forgotPasswordText\",\n          defaultMessage: \"Forgot your password?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 289,\n          columnNumber: 11\n        }, this), ' ', /*#__PURE__*/_jsxDEV(LinkButton, {\n          onClick: toggleForgotPassForm,\n          children: /*#__PURE__*/_jsxDEV(FormattedMessage, {\n            id: \"resetText\",\n            defaultMessage: \"Reset It\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 184,\n    columnNumber: 5\n  }, this);\n}","map":{"version":3,"sources":["/Users/alejandrosandoval/space/world_eserp/web/packages/shop-restaurant/src/features/authentication-form/login.tsx"],"names":["React","useContext","LinkButton","Button","Wrapper","Container","Heading","SubHeading","OfferSection","Offer","Divider","AuthContext","FormattedMessage","useIntl","closeModal","Input","useQuery","useMutation","GET_CLIENTE_USERNAME_PASSWORD","GET_CLIENTE_USERNAME","SET_CLIENTE","ADD_VISITA","GoogleLogin","SignInModal","cid","intl","authDispatch","id","setId","useState","user","setUser","email","setEmail","password","setPassword","addVisita","setCliente","data","error","loading","variables","clientid","username","data1","loading1","GoogleButton","responseGoogle","response","console","log","profileObj","localStorage","setItem","JSON","stringify","accessToken","type","renderProps","onClick","disabled","addVisitaUser","cliente","length","setClienteUser","nombre","name","familyName","imageURL","photoURL","toggleSignUpForm","toggleForgotPassForm","loginCallback","last_seen","alert","formatMessage","defaultMessage","e","target","value","width","padding"],"mappings":"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","sourcesContent":["import React, { useContext } from 'react';\nimport {\n  LinkButton,\n  Button,\n  IconWrapper,\n  Wrapper,\n  Container,\n  LogoWrapper,\n  Heading,\n  SubHeading,\n  OfferSection,\n  Offer,\n  // Input,\n  Divider,\n} from './authentication-form.style';\nimport { Facebook } from 'assets/icons/facebook';\nimport { Google } from 'assets/icons/google';\nimport { AuthContext } from 'contexts/auth/auth.context';\nimport { FormattedMessage, useIntl } from 'react-intl';\nimport { closeModal } from '@redq/reuse-modal';\nimport { Input } from 'components/forms/input';\nimport { useQuery,useMutation, NetworkStatus } from '@apollo/client';\nimport { GET_CLIENTE_USERNAME_PASSWORD } from '../../utils/graphql/query/clients.query';\nimport { GET_CLIENTE_USERNAME } from '../../utils/graphql/query/clients.query';\nimport { SET_CLIENTE } from '../../utils/graphql/mutation/register_client';\nimport { ADD_VISITA } from '../../utils/graphql/mutation/visitas';\nimport GoogleLogin from 'react-google-login';\n \n\nexport default function SignInModal({cid}) { \n  const intl = useIntl();\n  const { authDispatch } = useContext<any>(AuthContext);\n  const [id, setId] = React.useState(0);\n  const [user, setUser] = React.useState(null);\n  const [email, setEmail] = React.useState('');\n  const [password, setPassword] = React.useState('');\n  const [addVisita] = useMutation(ADD_VISITA );\n  const [setCliente] = useMutation(SET_CLIENTE );\n  const { data, error,loading } =  useQuery(\n    GET_CLIENTE_USERNAME_PASSWORD,\n    {\n      variables: {\n        clientid: cid,\n        username: email,\n        password: password\n      } \n    }\n  ); \n  const { data:data1,loading:loading1 } =  useQuery(\n    GET_CLIENTE_USERNAME,\n    {\n      variables: {\n        clientid: cid,\n        username: email\n      } \n    }\n  ); \n  function GoogleButton() {\n\n    const responseGoogle = (response) => {\n      console.log(response.data);\n      setUser(response.data.profileObj);\n      localStorage.setItem('user_logged', JSON.stringify(response.data.profileObj));\n      localStorage.setItem('access_token', JSON.stringify(response.data.accessToken));\n      authDispatch({ type: 'SIGNIN_SUCCESS' });  \n      setEmail(JSON.stringify(user.email))\n      \n      closeModal();\n    }\n    \n     return (\n        <GoogleLogin\n        clientId={'13854964639-ie0g4ejmkg7fa4e2gb0b2t7hci0b27u0.apps.googleusercontent.com'}\n        render={renderProps => (\n          <button variant='green' id=\"primary\" onClick={renderProps.onClick} disabled={renderProps.disabled}>This is my custom Google button</button>\n        )}\n        buttonText=\"Login\"\n        onSuccess={responseGoogle}\n        onFailure={responseGoogle}\n        cookiePolicy={'single_host_origin'}\n      />);\n    \n    }\n  const addVisitaUser = () => {\n    \n      if(data1 && data1.cliente.length > 0){\n        console.log('usuario Encontrado')\n        addVisita({\n          variables: {\n                    cliente: data.cliente[0].id, \n                    clientid: cid\n                  }\n        });\n        \n  \n      \n    };\n   }\n  \n  const setClienteUser = () => {\n      \n    if(data && data.cliente.length > 0){\n      console.log('usuario Encontrado')\n      setCliente({\n        variables: {\n                 clientid: cid,\n                  nombre: user.name + ' ' + user.familyName,\n                  email: user.email,\n                  imageURL: user.photoURL  \n                }\n      });\n  \n    \n  };\n  }\n\n\n\n  const toggleSignUpForm = () => {\n    authDispatch({\n      type: 'SIGNUP',\n    });\n  };\n\n  const toggleForgotPassForm = () => {\n    authDispatch({\n      type: 'FORGOTPASS',\n    });\n  };\n\n  const loginCallback = () => {\n    console.log('data...:',JSON.stringify(data))\n    // validamos username y password\n    if(data && data.cliente.length > 0){\n      console.log('usuario Encontrado')\n      addVisita({\n        variables: {\n                  cliente: data.cliente[0].id, \n                  clientid: cid\n                }\n      });\n      if (typeof window !== 'undefined') {\n        localStorage.setItem('access_token', `${data.cliente[0].last_seen}`);\n        localStorage.setItem('user_logged', JSON.stringify(data.cliente[0])); \n        authDispatch({ type: 'SIGNIN_SUCCESS' });\n        closeModal();\n      }\n    } else {\n      console.log('usuario NO existe');\n      alert('usuario no encontrado');\n    }\n\n    \n  };\n\n  /* const loginGoogleCall = () => { */\n\n      /* console.log('loginGoogleCall:', firebase)\n     \n      console.log('provider:', provider)\n\n      firebase.auth()\n      .signInWithPopup(provider)\n      .then((result) => {\n      \n        var credential = result.credential;\n        var user = result.user;\n        setEmail(user.email)\n        setCliente({\n          variables: {\n                    clientid: cid,\n                    nombre: user.displayName,\n                    email: user.email,\n                    imageURL: user.photoURL  \n                  }\n        });\n\n      \n      \n       \n        */\n  \n  return (\n    <Wrapper>\n      <Container>\n        <Heading>\n          <FormattedMessage id='welcomeBack' defaultMessage='Welcome Back' />\n        </Heading>\n\n        <SubHeading>\n          <FormattedMessage\n            id='loginText'\n            defaultMessage='Login with your email &amp; password'\n          />\n        </SubHeading>\n        <form onSubmit={loginCallback}>\n          <Input\n            type='email'\n            placeholder={intl.formatMessage({\n              id: 'emailAddressPlaceholder',\n              defaultMessage: 'Email Address.',\n            })}\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n            required\n            height='48px'\n            backgroundColor='#F7F7F7'\n            mb='10px'\n          />\n\n          <Input\n            type='password'\n            placeholder={intl.formatMessage({\n              id: 'passwordPlaceholder',\n              defaultMessage: 'Password (min 6 characters)',\n            })}\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            required\n            height='48px'\n            backgroundColor='#F7F7F7'\n            mb='10px'\n          />\n\n          <Button\n            variant='primary'\n            size='big'\n            style={{ width: '100%' }}\n            type='submit'\n          >\n            <FormattedMessage id='continueBtn' defaultMessage='Continue' />\n          </Button>\n        </form>\n        <Divider>\n          <span>\n            <FormattedMessage id='orText' defaultMessage='or' />\n          </span>\n        </Divider>\n{/* \n        <Button\n          variant='primary'\n          size='big'\n          style={{\n            width: '100%',\n            backgroundColor: '#4267b2',\n            marginBottom: 10,\n          }}\n          onClick={loginCallback}\n        >\n          <IconWrapper>\n            <Facebook />\n          </IconWrapper>\n          <FormattedMessage\n            id='continueFacebookBtn'\n            defaultMessage='Continue with Facebook'\n          />\n        </Button> */}\n\n      {/*   <Button\n          variant='primary'\n          size='big'\n          style={{ width: '100%', backgroundColor: '#ee1111' }}\n          onClick={loginGoogleCall}\n        >\n          <IconWrapper>\n            <Google />\n          </IconWrapper>\n          <FormattedMessage\n            id='continueGoogleBtn'\n            defaultMessage='Continue with Google'\n          />\n        </Button> */}\n\n        <GoogleButton />\n\n        <Offer style={{ padding: '20px 0' }}>\n          <FormattedMessage\n            id='dontHaveAccount'\n            defaultMessage=\"Don't have any account?\"\n          />{' '}\n          <LinkButton onClick={toggleSignUpForm}>\n            <FormattedMessage id='signUpBtnText' defaultMessage='Sign Up' />\n          </LinkButton>\n        </Offer>\n      </Container>\n\n      <OfferSection>\n        <Offer>\n          <FormattedMessage\n            id='forgotPasswordText'\n            defaultMessage='Forgot your password?'\n          />{' '}\n          <LinkButton onClick={toggleForgotPassForm}>\n            <FormattedMessage id='resetText' defaultMessage='Reset It' />\n          </LinkButton>\n        </Offer>\n      </OfferSection>\n    </Wrapper>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}